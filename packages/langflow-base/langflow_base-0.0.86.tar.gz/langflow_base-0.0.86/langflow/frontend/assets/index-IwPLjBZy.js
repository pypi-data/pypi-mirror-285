import{a$ as T,b0 as O,b1 as D,b2 as ee,b3 as se,b4 as ae,b5 as te,b6 as V,b7 as G,p as ne,aC as re,r as u,j as e,I as le,$ as v,aN as S,b8 as N,aQ as C,aP as E,aO as I,a as w,d as A,b9 as _,g as k,f as j,ba as H,aj as oe,bb as ie,aw as ce,bc as F,bd as de,be as ue,bf as he,bg as me,h as pe,au as xe,bh as fe,A as P,u as L,af as m}from"./index-DA6-777E.js";import{I as b}from"./index-oho8M-m_.js";import"./input-DaWbVnIY.js";import"./popover-IXFQ5Ue8.js";const ge=a=>{const{mutate:o}=T();return o(["usePostAddApiKey"],async s=>(await O.post(`${D("API_KEY")}/store`,{api_key:s.key})).data,a)},je=()=>{const{query:a}=T(),o=async()=>(await O.get(`${D("FILES")}/profile_pictures/list`)).data;return a(["useGetProfilePicturesQuery"],async()=>{var i;const s=await o(),r={};return(i=s==null?void 0:s.files)==null||i.forEach(c=>{const[l,h]=c.split("/");r[l]?r[l].push(h):r[l]=[h]}),r},{placeholderData:ee})},ye=(a,o,t)=>({handlePatchPassword:async(s,r,i)=>{var c,l;if(s!==r){t({title:se,list:[ae]});return}try{s!==""&&await te(a.id,{password:s}),i({target:{name:"password",value:""}}),i({target:{name:"cnfPassword",value:""}}),o({title:V})}catch(h){t({title:G,list:[(l=(c=h==null?void 0:h.response)==null?void 0:c.data)==null?void 0:l.detail]})}}}),Pe=(a,o,t,d)=>({currentUserData:t,handlePatchProfilePicture:async r=>{var i,c;try{if(r!==""){await ne(t.id,{profile_image:r});let l=re(t);l.profile_image=r,d(l)}a({title:V})}catch(l){o({title:G,list:[(c=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:c.detail]})}}}),we=(a,o)=>{u.useEffect(()=>{const t=document.getElementById(a??"null");t&&t.scrollIntoView({behavior:"smooth"})},[a]),u.useEffect(()=>{o("")},[o])},Ae=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["General",e.jsx(le,{name:"SlidersHorizontal",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage settings related to Langflow and your account."})]})})}),be=({password:a,cnfPassword:o,handleInput:t,handlePatchPassword:d})=>e.jsx(e.Fragment,{children:e.jsx(v,{onSubmit:s=>{d(a,o,t),s.preventDefault()},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-2",children:[e.jsxs(N,{children:[e.jsx(C,{children:"Password"}),e.jsx(E,{children:"Type your new password and confirm it."})]}),e.jsx(I,{children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs(w,{name:"password",className:"w-full",children:[e.jsx(b,{id:"pasword",onChange:s=>{t({target:{name:"password",value:s}})},value:a,isForm:!0,password:!0,placeholder:"Password",className:"w-full"}),e.jsx(A,{match:"valueMissing",className:"field-invalid",children:"Please enter your password"})]}),e.jsxs(w,{name:"cnfPassword",className:"w-full",children:[e.jsx(b,{id:"cnfPassword",onChange:s=>{t({target:{name:"cnfPassword",value:s}})},value:o,isForm:!0,password:!0,placeholder:"Confirm Password",className:"w-full"}),e.jsx(A,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})]})}),e.jsx(_,{className:"border-t px-6 py-4",children:e.jsx(k,{asChild:!0,children:e.jsx(j,{type:"submit",children:"Save"})})})]})})}),ve=(a,o,t)=>{const d=async s=>Promise.all(s.map(r=>new Promise(i=>{const c=new Image;c.src=r,c.onload=i,c.onerror=i})));u.useEffect(()=>{if(t||!a)return;const s=[];Object.keys(a).flatMap(r=>a[r].map(i=>s.push(`${H}files/profile_pictures/${r}/${i}`))),d(s).then(()=>{o(!0)})},[a,t])};function Se({profilePictures:a,loading:o,value:t,onChange:d}){const s=u.useRef(null),r=oe(l=>l.dark),[i,c]=u.useState(!1);return u.useEffect(()=>{var l;t&&s&&((l=s.current)==null||l.scrollIntoView({behavior:"smooth",block:"center"}))},[s,t]),ve(a,c,o),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:o||!i?e.jsx(ie,{}):Object.keys(a).map((l,h)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"edit-flow-arrangement",children:e.jsx("span",{className:"font-normal",children:l})}),e.jsx("div",{className:"block overflow-hidden",children:e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto rounded-lg bg-muted px-1 custom-scroll",children:a[l].map((p,y)=>e.jsx(j,{ref:t===l+"/"+p?s:void 0,unstyled:!0,onClick:()=>d(l+"/"+p),className:"shrink-0 px-0.5 py-2",children:e.jsx("img",{src:`${H}files/profile_pictures/${l+"/"+p}`,style:{filter:t===l+"/"+p?r?"drop-shadow(0 0 0.3rem rgb(255, 255, 255))":"drop-shadow(0 0 0.3rem rgb(0, 0, 0))":""},className:ce("h-12 w-12")},y)}))})})]}))})}const Ne=({profilePicture:a,handleInput:o,handlePatchProfilePicture:t,handleGetProfilePictures:d,userData:s})=>{const{data:r,isFetching:i}=d;return e.jsx(v,{onSubmit:c=>{t(a),c.preventDefault()},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(N,{children:[e.jsx(C,{children:"Profile Picture"}),e.jsx(E,{children:"Choose the image that appears as your profile picture."})]}),e.jsx(I,{children:e.jsx("div",{className:"py-2",children:e.jsx(Se,{profilePictures:r,loading:i,value:a==""?(s==null?void 0:s.profile_image)??F[parseInt((s==null?void 0:s.id)??"",30)%F.length]:a,onChange:c=>{o({target:{name:"profilePicture",value:c}})}})})}),e.jsx(_,{className:"border-t px-6 py-4",children:e.jsx(k,{asChild:!0,children:e.jsx(j,{type:"submit",children:"Save"})})})]})})},Ce=({apikey:a,handleInput:o,handleSaveKey:t,loadingApiKey:d,validApiKey:s,hasApiKey:r})=>e.jsx(e.Fragment,{children:e.jsx(v,{onSubmit:i=>{i.preventDefault(),t(a,o)},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-2",id:"api",children:[e.jsxs(N,{children:[e.jsx(C,{children:"Store API Key"}),e.jsx(E,{children:(r&&!s?de:r?"":ue)+he})]}),e.jsx(I,{children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"flex w-full gap-4",children:e.jsxs(w,{name:"apikey",className:"w-full",children:[e.jsx(b,{id:"apikey",onChange:i=>{o({target:{name:"apikey",value:i}})},value:a,isForm:!0,password:!0,placeholder:"Insert your API Key",className:"w-full"}),e.jsx(A,{match:"valueMissing",className:"field-invalid",children:"Please enter your API Key"})]})}),e.jsxs("span",{className:"pr-1 text-xs text-muted-foreground",children:[me," ",e.jsx("a",{className:"text-high-indigo underline",href:"https://langflow.store/",target:"_blank",children:"langflow.store"})]})]})}),e.jsx(_,{className:"border-t px-6 py-4",children:e.jsx(k,{asChild:!0,children:e.jsx(j,{loading:d,type:"submit","data-testid":"api-key-save-button-store",children:"Save"})})})]})})}),Ke=()=>{const a=pe(n=>n.setCurrentFlowId),{scrollId:o}=xe(),[t,d]=u.useState(fe),{autoLogin:s}=u.useContext(P),r=L(n=>n.setSuccessData),i=L(n=>n.setErrorData),{userData:c,setUserData:l}=u.useContext(P),h=m(n=>n.hasStore),p=m(n=>n.validApiKey),y=m(n=>n.hasApiKey),M=m(n=>n.loadingApiKey),{password:U,cnfPassword:Y,profilePicture:q,apikey:B}=t,{storeApiKey:Q}=u.useContext(P),K=m(n=>n.updateHasApiKey),R=m(n=>n.updateValidApiKey),$=m(n=>n.updateLoadingApiKey),{handlePatchPassword:W}=ye(c,r,i),z=je(),{handlePatchProfilePicture:J}=Pe(r,i,c,l);we(o,a);const{mutate:X}=ge({onSuccess:()=>{r({title:"API key saved successfully"}),K(!0),R(!0),$(!1),x({target:{name:"apikey",value:""}})},onError:n=>{var f,g;i({title:"API key save error",list:[(g=(f=n==null?void 0:n.response)==null?void 0:f.data)==null?void 0:g.detail]}),K(!1),R(!1),$(!1)}}),Z=n=>{n&&(X({key:n}),Q(n))};function x({target:{name:n,value:f}}){d(g=>({...g,[n]:f}))}return e.jsxs("div",{className:"flex h-full w-full flex-col gap-6",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(Ne,{profilePicture:q,handleInput:x,handlePatchProfilePicture:J,handleGetProfilePictures:z,userData:c}),!s&&e.jsx(be,{password:U,cnfPassword:Y,handleInput:x,handlePatchPassword:W}),h&&e.jsx(Ce,{apikey:B,handleInput:x,handleSaveKey:Z,loadingApiKey:M,validApiKey:p,hasApiKey:y})]})]})};export{Ke as GeneralPage,Ke as default};
