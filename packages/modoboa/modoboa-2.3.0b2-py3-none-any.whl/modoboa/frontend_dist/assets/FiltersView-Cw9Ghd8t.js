import{b as oe,a2 as ne,h as v,o as f,c as S,w as p,a as e,f as o,k as F,H as ce,K as fe,Q as M,$ as Ue,a7 as re,aG as Ae,z as le,O as Re,am as Ne,R as j,B as J,e as D,t as G,X as N,Z as W,Y as q,g as $e,q as Ie,j as ee}from"./index-B6sfQZUh.js";import{V as ie,r as T}from"./VForm-CVtiyeDB.js";import{a as ve,b as pe,c as Ve}from"./VCard-CKOt35J8.js";import{V as H,m as Oe,a as se}from"./VTextField-xrmh1FWy.js";import{V as ye}from"./VSwitch-Bvl549Dr.js";import{d as be}from"./VList-BoxPhnZ6.js";import{V as ge}from"./VSpacer-BMAkDs-u.js";import{V as _,i as Pe}from"./VImg-AVVNtsoJ.js";import{m as Te,a as ae,b as De,c as je}from"./VChip-CRYOXnOA.js";import{a as qe}from"./VField-Bhyg59H4.js";import{u as Fe}from"./tag-wMOM-gqO.js";import{V as z}from"./VSelect-B9nLCGKh.js";import{V as Be}from"./VCheckbox-CAjAGN0I.js";import{_ as ue}from"./MenuItems-DpSUv0fF.js";import{V as Ge}from"./VToolbar-i9pq53Nj.js";import{V as Ee}from"./VDataTable-gjt2Fg5z.js";import{V as de}from"./VDialog-n5-nWTx5.js";import{V as Le}from"./VAutocomplete-D7qVHjLV.js";import{V as me}from"./VMenu-uuonQ6o9.js";import{V as Me}from"./VTextarea-CfzjedqN.js";import"./forwardRefs-DWGaNmQL.js";import"./createSimpleFunctional-BdzT111U.js";import"./VAvatar-xee8L3pJ.js";import"./dimensions-CKYnSDDa.js";import"./ssrBoot-CPdEBhNq.js";/* empty css              */import"./dialog-transition-InZxhk0f.js";import"./VOverlay-GMQTQL34.js";import"./lazy-YEt_kfmk.js";import"./filter-CcSZdtpY.js";const ze={__name:"FilterSetForm",emits:["close"],setup(V,{emit:U}){const{$gettext:m}=oe(),g=U,n=ne(),a=v({}),k=v(),y=v(!1);function l(){k.value.reset(),a.value={},g("close")}async function A(){const{valid:r}=await k.value.validate();if(r){y.value=!0;try{await F.createFilterSet(a.value),n.displayNotification({msg:m("Filter set created")}),l()}finally{y.value=!1}}}return(r,h)=>(f(),S(Ve,{title:o(m)("Create a new filter set")},{default:p(()=>[e(ve,null,{default:p(()=>[e(ie,{ref_key:"formRef",ref:k},{default:p(()=>[e(H,{modelValue:a.value.name,"onUpdate:modelValue":h[0]||(h[0]=C=>a.value.name=C),label:o(m)("Name"),variant:"outlined",rules:[o(T).required]},null,8,["modelValue","label","rules"]),e(ye,{label:o(m)("Active"),modelValue:a.value.active,"onUpdate:modelValue":h[1]||(h[1]=C=>a.value.active=C),color:"primary"},null,8,["label","modelValue"])]),_:1},512)]),_:1}),e(be),e(pe,null,{default:p(()=>[e(ge),e(_,{text:o(m)("Cancel"),variant:"plain",onClick:l},null,8,["text"]),e(_,{color:"primary",text:o(m)("Create"),onClick:A},null,8,["text"])]),_:1})]),_:1},8,["title"]))}},Je=ce({...Te({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),te=fe()({name:"VRadio",props:Je(),setup(V,U){let{slots:m}=U;return Fe(()=>{const g=ae.filterProps(V);return e(ae,M(g,{class:["v-radio",V.class],style:V.style,type:"radio"}),m)}),{}}}),He=ce({height:{type:[Number,String],default:"auto"},...Oe(),...Ue(De(),["multiple"]),trueIcon:{type:re,default:"$radioOn"},falseIcon:{type:re,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Ke=fe()({name:"VRadioGroup",inheritAttrs:!1,props:He(),emits:{"update:modelValue":V=>!0},setup(V,U){let{attrs:m,slots:g}=U;const n=Ae(),a=le(()=>V.id||`radio-group-${n}`),k=Re(V,"modelValue");return Fe(()=>{const[y,l]=Ne(m),A=se.filterProps(V),r=ae.filterProps(V),h=g.label?g.label({label:V.label,props:{for:a.value}}):V.label;return e(se,M({class:["v-radio-group",V.class],style:V.style},y,A,{modelValue:k.value,"onUpdate:modelValue":C=>k.value=C,id:a.value}),{...g,default:C=>{let{id:$,messagesId:O,isDisabled:I,isReadonly:x}=C;return e(j,null,[h&&e(qe,{id:$.value},{default:()=>[h]}),e(je,M(r,{id:$.value,"aria-describedby":O.value,defaultsTarget:"VRadio",trueIcon:V.trueIcon,falseIcon:V.falseIcon,type:V.type,disabled:I.value,readonly:x.value,"aria-labelledby":h?$.value:void 0,multiple:!1},l,{modelValue:k.value,"onUpdate:modelValue":E=>k.value=E}),g)])}})}),{}}}),Qe={class:"bg-grey-lighten-4 rounded pa-3"},Xe={class:"d-flex align-center"},Ye={class:"mt-4 bg-grey-lighten-4 rounded pa-3"},Ze={class:"d-flex align-start mt-2"},We={class:"mx-2 d-flex flex-column flex-grow-1"},et={__name:"FilterForm",props:{filterSet:{type:String,default:null},filter:{type:Object,required:!1,default:null}},emits:["close"],setup(V,{emit:U}){const m=V,g=U,n=ne(),{$gettext:a}=oe(),k=v({}),y=v([]),l=v([]),A=v(),r=v(x()),h=v(!1),C=le(()=>m.filter?a("Edit filter"):a("New filter")),$=le(()=>m.filter?a("Update"):a("Create"));let O;J(()=>m.filter,c=>{c?(r.value=JSON.parse(JSON.stringify(c)),O=c.name):r.value=x()},{immediate:!0});function I(){g("close"),r.value=x()}function x(){return{match_type:"anyof",conditions:[{}],actions:[{args:{}}]}}function E(c){for(const b of y.value)if(b.name===c)return b.operators;return[]}function K(c){for(const b of y.value)if(b.name===r.value.conditions[c].name){for(const s of b.operators)if(s.name===r.value.conditions[c].operator)return s.type==="string"?"text":"number"}}function Q(c){for(const b of l.value)if(b.name===c)return b.args;return[]}function X(){r.value.conditions.push({name:y.value[0].name,operator:y.value[0].operators[0].name})}function L(c){r.value.conditions.splice(c,1)}function P(){r.value.actions.push({name:l.value[0].name,args:{}})}function Y(c){r.value.actions.splice(c,1)}async function Z(){const{valid:c}=await A.value.validate();if(!c)return;h.value=!0;let b;const s=JSON.parse(JSON.stringify(r.value));for(const w of s.actions)for(const[d,R]of Object.entries(w.args))typeof R=="boolean"&&!R&&delete w.args[d];try{m.filter?(await F.updateFilter(m.filterSet,O,s),b=a("Filter updated")):(await F.createFilter(m.filterSet,s),b=a("Filter added"))}catch(w){w.response.status===400&&w.response.data&&(k.value=w.response.data);return}finally{h.value=!1}n.displayNotification({msg:b}),I()}return F.getFilterConditionTemplates().then(c=>{y.value=c.data,m.filter||(r.value.conditions[0].name=y.value[0].name,r.value.conditions[0].operator=y.value[0].operators[0].name)}),F.getFilterActionTemplates().then(c=>{l.value=c.data,m.filter||(r.value.actions[0].name=l.value[0].name)}),(c,b)=>(f(),S(Ve,{title:C.value},{default:p(()=>[e(ve,null,{default:p(()=>[e(ie,{ref_key:"formRef",ref:A},{default:p(()=>[e(H,{modelValue:r.value.name,"onUpdate:modelValue":b[0]||(b[0]=s=>r.value.name=s),label:o(a)("Name"),variant:"outlined",density:"compact",rules:[o(T).required],"error-messages":k.value.name?k.value.name:[]},null,8,["modelValue","label","rules","error-messages"]),D("div",Qe,[D("h4",null,G(o(a)("Conditions")),1),e(Ke,{modelValue:r.value.match_type,"onUpdate:modelValue":b[1]||(b[1]=s=>r.value.match_type=s),color:"primary",inline:""},{default:p(()=>[e(te,{label:o(a)("All of the following"),value:"allof"},null,8,["label"]),e(te,{label:o(a)("Any of the following"),value:"anyof"},null,8,["label"]),e(te,{label:o(a)("All messages"),value:"all"},null,8,["label"])]),_:1},8,["modelValue"]),r.value.match_type!=="all"?(f(!0),N(j,{key:0},W(r.value.conditions,(s,w)=>(f(),N("div",Xe,[e(z,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(a)("Choose a header"),items:y.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),e(z,{modelValue:s.operator,"onUpdate:modelValue":d=>s.operator=d,label:o(a)("Choose an operator"),items:E(s.name),"item-title":"label","item-value":"name",variant:"outlined",class:"ml-2",density:"compact",rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),e(H,{modelValue:s.value,"onUpdate:modelValue":d=>s.value=d,label:o(a)("Value"),variant:"outlined",class:"ml-2",density:"compact",type:K(w),rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","label","type","rules"]),w===0?(f(),S(_,{key:0,icon:"mdi-plus",variant:"text",title:o(a)("Add condition"),color:"primary",onClick:X},null,8,["title"])):(f(),S(_,{key:1,icon:"mdi-trash-can",variant:"text",title:o(a)("Remove condition"),color:"error",onClick:d=>L(w)},null,8,["title","onClick"]))]))),256)):q("",!0)]),D("div",Ye,[D("h4",null,G(o(a)("Actions")),1),(f(!0),N(j,null,W(r.value.actions,(s,w)=>(f(),N("div",Ze,[e(z,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(a)("Choose an action"),items:l.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",class:"flex-grow-0"},null,8,["modelValue","onUpdate:modelValue","label","items"]),D("div",We,[(f(!0),N(j,null,W(Q(s.name),d=>(f(),N(j,null,[d.type==="list"?(f(),S(z,{key:0,modelValue:s.args[d.name],"onUpdate:modelValue":R=>s.args[d.name]=R,items:d.choices,"item-title":"label",density:"compact",variant:"outlined",rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])):q("",!0),d.type==="string"?(f(),S(H,{key:1,modelValue:s.args[d.name],"onUpdate:modelValue":R=>s.args[d.name]=R,density:"compact",variant:"outlined",rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","rules"])):q("",!0),d.type==="boolean"?(f(),S(Be,{key:2,modelValue:s.args[d.name],"onUpdate:modelValue":R=>s.args[d.name]=R,label:d.label,color:"primary",value:d.value,density:"compact"},null,8,["modelValue","onUpdate:modelValue","label","value"])):q("",!0)],64))),256))]),w===0?(f(),S(_,{key:0,icon:"mdi-plus",variant:"text",title:o(a)("Add action"),color:"primary",onClick:P},null,8,["title"])):(f(),S(_,{key:1,icon:"mdi-trash-can",variant:"text",title:o(a)("Remove action"),color:"error",onClick:d=>Y(w)},null,8,["title","onClick"]))]))),256))])]),_:1},512)]),_:1}),e(be),e(pe,null,{default:p(()=>[e(ge),e(_,{text:o(a)("Cancel"),variant:"elevated",onClick:I},null,8,["text"]),e(_,{color:"primary",variant:"elevated",text:$.value,loading:h.value,onClick:Z},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},tt={class:"pa-4"},lt={class:"text-h6 font-weight-regular mb-4"},at={key:0,class:"bg-white mt-4 pa-2"},ot={class:"d-flex align-center"},Pt={__name:"FiltersView",setup(V){const U=$e(),m=Ie(),g=ne(),{$gettext:n}=oe(),a=v([]),k=v([]),y=v(""),l=v(),A=v(!1),r=v([]),h=v(),C=v(!1),$=v(!1),O=v(null),I=v(!1),x=v(!1),E=[{title:n("Name"),key:"name"},{title:n("Active"),key:"enabled"},{title:"",key:"filter_actions",align:"end"}];J(l,t=>{t?(P(t.name),m.params.filterset!==t.name&&U.push({name:"AccountFilters",params:{filterset:t.name}})):U.push({name:"AccountFilters"})}),J(C,t=>{t?F.downloadFilterSet(l.value.name).then(i=>{y.value=i.data}):P(l.value.name)}),J(y,()=>{r.value.length&&(r.value=[])});function K(t){let i=t.name;return t.active&&(i+=" ("+n("active")+")"),i}function Q(){I.value=!1,L()}function X(){x.value=!1,O.value=null,P(l.value.name)}function L(){F.getFilterSets().then(t=>{if(a.value=t.data,!l.value&&m.params.filterset){for(const i of a.value)if(i.name===m.params.filterset){l.value=i;break}}})}function P(t){A.value=!0,F.getFilters(t).then(i=>{k.value=i.data,A.value=!1})}function Y(t){O.value=t,x.value=!0}function Z(t){F.enableFilter(l.value.name,t.name).then(()=>{t.enabled=!0,g.displayNotification({msg:n("Filter enabled")})})}function c(t){F.disableFilter(l.value.name,t.name).then(()=>{t.enabled=!1,g.displayNotification({msg:n("Filter disabled")})})}function b(t){F.deleteFilter(l.value.name,t.name).then(()=>{g.displayNotification({msg:n("Filter removed")}),P(l.value.name)})}async function s(t){await F.moveFilterDown(l.value.name,t.name),P(l.value.name)}async function w(t){await F.moveFilterUp(l.value.name,t.name),P(l.value.name)}async function d(t){await F.activateFilterSet(t.name),g.displayNotification({msg:n("Filter set activated")})}async function R(t){await F.deleteFilterSet(t.name),g.displayNotification({msg:n("Filter set removed")}),l.value=null,L()}async function ke(){const{valid:t}=await h.value.validate();if(!t)return;const i={content:y.value};$.value=!0;try{await F.saveFilterSet(l.value.name,i),g.displayNotification({msg:n("Filter set updated")})}catch(u){u.response.status===400&&u.response.data.content&&(r.value=u.response.data.content)}finally{$.value=!1}}async function he(t){const i=await F.downloadFilterSet(t.name),u=new Blob([i.data],{type:"text/plain"}),B=document.createElement("a");B.href=URL.createObjectURL(u),B.download=`${t.name}.txt`,B.click(),URL.revokeObjectURL(B.href)}const we=[{label:n("Edit"),icon:"mdi-circle-edit-outline",onClick:Y},{label:n("Delete"),icon:"mdi-delete-outline",onClick:b,color:"red"}];function Ce(t,i){const u=[...we];return t.enabled?u.push({label:n("Disable"),icon:"mdi-stop",color:"red",onClick:c}):u.push({label:n("Enable"),icon:"mdi-check",color:"success",onClick:Z}),i!==k.value.length-1&&u.push({label:n("Move down"),icon:"mdi-arrow-down",onClick:s}),i!==0&&u.push({label:n("Move up"),icon:"mdi-arrow-up",onClick:w}),u}const _e=[{label:n("Download filter set"),icon:"mdi-download",onClick:he},{label:n("Delete filter set"),color:"error",icon:"mdi-trash-can",onClick:R}];function Se(){const t=[];return l.value.active||t.push({label:n("Activate filter set"),color:"success",icon:"mdi-check",onClick:d}),t.concat(_e)}return L(),(t,i)=>(f(),N(j,null,[D("div",tt,[D("div",lt,G(o(n)("Message filters")),1),e(Ge,{dense:"",floating:"",color:"white"},{default:p(()=>[e(Le,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=u=>l.value=u),label:o(n)("Select a filter set"),items:a.value,"item-title":K,"return-object":"",variant:"outlined","hide-details":"",class:"flex-grow-0",style:{width:"200px"},density:"compact"},null,8,["modelValue","label","items"]),e(_,{color:"primary",icon:"mdi-plus",size:"small",class:"mx-4",onClick:i[1]||(i[1]=u=>I.value=!0),title:o(n)("Add filter set")},null,8,["title"]),l.value?(f(),S(me,{key:0},{activator:p(({props:u})=>[e(_,M({icon:"mdi-dots-vertical"},u,{size:"small",color:"default"}),null,16)]),default:p(()=>[e(ue,{items:Se(),obj:l.value},null,8,["items","obj"])]),_:1})):q("",!0),l.value?(f(),S(ye,{key:1,modelValue:C.value,"onUpdate:modelValue":i[2]||(i[2]=u=>C.value=u),label:o(n)("Raw mode"),color:"primary",class:"ml-4","hide-details":""},null,8,["modelValue","label"])):q("",!0)]),_:1}),l.value?(f(),N("div",at,[C.value?(f(),N(j,{key:1},[e(ie,{ref_key:"rawFormRef",ref:h},{default:p(()=>[e(Me,{modelValue:y.value,"onUpdate:modelValue":i[4]||(i[4]=u=>y.value=u),variant:"outlined","auto-grow":"",rules:[o(T).required],"error-messages":r.value},null,8,["modelValue","rules","error-messages"])]),_:1},512),e(_,{color:"success",onClick:ke,loading:$.value,class:"mt-2"},{default:p(()=>[ee(G(o(n)("Save")),1)]),_:1},8,["loading"])],64)):(f(),N(j,{key:0},[D("div",ot,[e(_,{color:"primary",title:o(n)("Add new filter"),onClick:i[3]||(i[3]=u=>x.value=!0),class:"mx-auto"},{default:p(()=>[e(Pe,{icon:"mdi-plus"}),ee(" "+G(o(n)("Add")),1)]),_:1},8,["title"])]),e(Ee,{headers:E,items:k.value,loading:A.value},{"item.enabled":p(({item:u})=>[ee(G(t.$yesno(u.enabled)),1)]),"item.filter_actions":p(({index:u,item:B})=>[e(me,{"offset-y":""},{activator:p(({props:xe})=>[e(_,M({icon:"mdi-dots-horizontal",variant:"text"},xe),null,16)]),default:p(()=>[e(ue,{items:Ce(B,u),obj:B},null,8,["items","obj"])]),_:2},1024)]),_:2},1032,["items","loading"])],64))])):q("",!0)]),e(de,{modelValue:I.value,"onUpdate:modelValue":i[5]||(i[5]=u=>I.value=u),"max-width":"600"},{default:p(()=>[e(ze,{onClose:Q})]),_:1},8,["modelValue"]),e(de,{modelValue:x.value,"onUpdate:modelValue":i[6]||(i[6]=u=>x.value=u),"max-width":"800"},{default:p(()=>[l.value?(f(),S(et,{key:0,"filter-set":l.value.name,filter:O.value,onClose:X},null,8,["filter-set","filter"])):q("",!0)]),_:1},8,["modelValue"])],64))}};export{Pt as default};
