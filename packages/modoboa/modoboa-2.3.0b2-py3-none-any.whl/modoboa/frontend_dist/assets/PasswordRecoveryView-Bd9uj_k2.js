import{_ as C}from"./Modoboa_RVB-BLANC-SANS-BbMFcwZs.js";import{g as F,b as T,h as i,o as d,c as _,w as t,a as s,n as B,e as n,t as u,f as o,j as D,p as L,m as j}from"./index-B6sfQZUh.js";import{_ as N}from"./ConfirmDialog-CB9bATIP.js";import{V as S,r as b}from"./VForm-CVtiyeDB.js";import{a as R,V as y}from"./VRow-DllmF7yv.js";import{V as $}from"./VTextField-xrmh1FWy.js";import{V as A,a as E}from"./VImg-AVVNtsoJ.js";import{V as I}from"./VContainer-D_MLw6yn.js";import"./VCard-CKOt35J8.js";import"./tag-wMOM-gqO.js";import"./createSimpleFunctional-BdzT111U.js";import"./VAvatar-xee8L3pJ.js";import"./dimensions-CKYnSDDa.js";import"./VToolbar-i9pq53Nj.js";import"./VSpacer-BMAkDs-u.js";/* empty css              */import"./VDialog-n5-nWTx5.js";import"./VOverlay-GMQTQL34.js";import"./forwardRefs-DWGaNmQL.js";import"./lazy-YEt_kfmk.js";import"./dialog-transition-InZxhk0f.js";import"./VField-Bhyg59H4.js";const K={class:"text-primary mb-10 text-h4"},q={class:"m-label"},z={class:"d-flex justify-center"},k={__name:"PasswordRecoveryForm",setup(P){const m=F(),{$gettext:a}=T(),l=i(!1),p=i(""),g=i(null),v=i(null),f=i([]);function h(){m.push({name:"Login"})}async function V(c,r,e=!1){let x="info";e&&(x="error"),await g.value.open(c,r,{color:x,cancelLabel:a("Ok"),agreeLabel:a("Return to login")})&&h()}async function w(){const{valid:c}=await v.value.validate();if(!c)return;const r={email:p.value};l.value=!0,L.recoverPassword(r).then(async e=>{l.value=!1,e.status===200&&(e.data.type==="sms"?m.push({name:"PasswordRecoverySmsTotpForm"}):e.data.type==="email"&&await V("Info",a("Email sent, please check your inbox")))}).catch(e=>{l.value=!1,e.response.status===404?(e.response.data.type==="sms"||e.response.data.type==="email")&&(f.value=[a(e.response.data.reason)]):e.response.status===503&&e.response.data.type==="email"?V("Error",e.response.data.reason,!0):e.response.status===429&&(f.value=[a("Too many unsuccessful attempts, please try later.")])})}return(c,r)=>(d(),_(I,{class:"fill-height",fluid:""},{default:t(()=>[s(R,{align:"center",justify:"center"},{default:t(()=>[s(y,{cols:"12",sm:"10",md:"8",class:"text-center",onKeyup:B(w,["enter"])},{default:t(()=>[n("h4",K,u(o(a)("Forgot password?")),1),s(S,{ref_key:"observer",ref:v,class:"my-4"},{default:t(()=>[n("label",q,u(o(a)("Please fill-in your primary email address")),1),s($,{modelValue:p.value,"onUpdate:modelValue":r[0]||(r[0]=e=>p.value=e),variant:"outlined",rules:[o(b).required,o(b).email],"error-messages":f.value},null,8,["modelValue","rules","error-messages"])]),_:1},512),n("div",z,[s(A,{class:"flex-grow-1",color:"primary",size:"large",loading:l.value,onClick:w},{default:t(()=>[D(u(o(a)("Submit")),1)]),_:1},8,["loading"])]),n("div",null,[n("a",{class:"float-right text-primary",onClick:h},u(o(a)("Return to login")),1)])]),_:1}),s(N,{ref_key:"dialog",ref:g},null,512)]),_:1})]),_:1}))}},pe={__name:"PasswordRecoveryView",setup(P){const{smAndDown:m}=j();return(a,l)=>o(m)?(d(),_(k,{key:0})):(d(),_(R,{key:1,class:"fill-height ma-0"},{default:t(()=>[s(y,{class:"bg-primary"},{default:t(()=>[s(E,{src:C,"max-width":"300",class:"mt-10 ml-8"})]),_:1}),s(y,{class:"text-center"},{default:t(()=>[s(k)]),_:1})]),_:1}))}};export{pe as default};
