import{_ as P}from"./Modoboa_RVB-BLANC-SANS-BbMFcwZs.js";import{b as j,g as F,h as i,r as B,o as _,c as y,w as o,a as t,n as D,e as c,t as m,f as r,j as V,p as x,m as E}from"./index-B6sfQZUh.js";import{V as L,r as k}from"./VForm-CVtiyeDB.js";import{_ as $}from"./ConfirmDialog-CB9bATIP.js";import{a as b,V as h}from"./VRow-DllmF7yv.js";import{V as K}from"./VTextField-xrmh1FWy.js";import{V as N,a as A}from"./VImg-AVVNtsoJ.js";import{V as M}from"./VContainer-D_MLw6yn.js";import"./tag-wMOM-gqO.js";import"./VField-Bhyg59H4.js";import"./forwardRefs-DWGaNmQL.js";import"./VCard-CKOt35J8.js";import"./createSimpleFunctional-BdzT111U.js";import"./VAvatar-xee8L3pJ.js";import"./dimensions-CKYnSDDa.js";import"./VToolbar-i9pq53Nj.js";import"./VSpacer-BMAkDs-u.js";/* empty css              */import"./VDialog-n5-nWTx5.js";import"./VOverlay-GMQTQL34.js";import"./lazy-YEt_kfmk.js";import"./dialog-transition-InZxhk0f.js";const U={class:"text-primary mb-6 text-h4"},q={class:"m-label"},z={class:"d-flex justify-center"},S={__name:"PasswordRecoverySmsTotpForm",setup(R){const{$gettext:e}=j(),u=F(),g=i(null),l=i(!1),p=i(null),v=i(""),f=i([]);async function w(a){const n=await n.value.open(e("Error"),a,{color:"error",cancelLabel:e("Return to login"),agreeLabel:e("Retry reset")});n?u.push({name:"PasswordRecoveryForm"}):u.push({name:"Login"})}async function T(){x.checkSmsTotp({type:"resend"}).then(a=>{l.value=!1,a.status===200&&p.value.setErrors({sms_totp:this.$gettext("TOTP resent.")})}).catch(async a=>{a.response.status===400?(this.loading=!1,await w(e("User seems wrong, return to login or restart reset the process?"))):a.response.status===429&&(f.value=[e("Too many unsuccessful attempts, please try later.")])})}async function C(){const{valid:a}=await p.value.validate();if(!a)return;const n={type:"confirm",sms_totp:this.sms_totp};l.value=!0,x.checkSmsTotp(n).then(s=>{l.value=!1,s.status===200&&u.push({name:"PasswordRecoveryChangeForm",data:s.response.data})}).catch(async s=>{l.value=!1,s.response.status===403&&"reason"in s.response.data?await w(s.response.data.reason):s.response.status===400&&"reason"in s.response.data&&(f.value=[e(s.response.data.reason)])})}return(a,n)=>{const s=B("router-link");return _(),y(M,{class:"fill-height",fluid:""},{default:o(()=>[t(b,{align:"center",justify:"center"},{default:o(()=>[t(h,{cols:"12",sm:"6",class:"d-flex flex-column justify-center pa-10",onKeyup:D(a.changePassword,["enter"])},{default:o(()=>[t($,{ref_key:"confirm",ref:g},null,512),c("h4",U,m(r(e)("Password recovery")),1),t(L,{ref_key:"observer",ref:p},{default:o(()=>[c("label",q,m(r(e)("Enter the code you've just received by SMS")),1),t(K,{modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=d=>v.value=d),type:"totp",variant:"outlined",rules:[r(k).required,d=>r(k).length(d,6)],"error-messages":f.value},null,8,["modelValue","rules","error-messages"])]),_:1},512),c("div",z,[t(N,{class:"flex-grow-1",color:"primary",size:"large",loading:l.value,onClick:C},{default:o(()=>[V(m(r(e)("Submit")),1)]),_:1},8,["loading"])]),c("div",null,[c("a",{class:"float-left text-primary",onClick:T},m(r(e)("Resend SMS.")),1),t(s,{to:{name:"Login"},class:"float-right text-primary"},{default:o(()=>[V(m(r(e)("Return to login")),1)]),_:1})])]),_:1},8,["onKeyup"])]),_:1})]),_:1})}}},pe={__name:"PasswordRecoverySmsTotpView",setup(R){const{smAndDown:e}=E();return(u,g)=>r(e)?(_(),y(S,{key:0})):(_(),y(b,{key:1,class:"fill-height ma-0"},{default:o(()=>[t(h,{class:"bg-primary"},{default:o(()=>[t(A,{src:P,"max-width":"300",class:"mt-10 ml-8"})]),_:1}),t(h,{class:"text-center"},{default:o(()=>[t(S)]),_:1})]),_:1}))}};export{pe as default};
