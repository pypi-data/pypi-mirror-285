import{b as oe,Z as ne,G as v,o as f,c as S,w as p,a as e,f as o,aK as F,q as ce,z as fe,I as M,W as Ue,a3 as re,aC as Ae,i as le,F as Re,ai as Ne,J as q,k as z,e as D,t as B,Q as N,U as Y,S as j,N as $e,M as Ie,R as ee}from"./index-8KTu6Yjm.js";import{V as ie,r as T}from"./VForm-B6XZMar3.js";import{a as ve,b as pe,c as Ve}from"./VCard-D-oNwPin.js";import{V as K,m as Oe,a as se,e as Pe}from"./VTextField-DfenxWrv.js";import{V as ye}from"./VSwitch-Bg3X--SO.js";import{d as be}from"./forwardRefs-Bzah7Mpr.js";import{V as ge}from"./VSpacer-DyadbvqZ.js";import{h as _,i as Te}from"./index-JekaRX8L.js";import{m as De,a as ae,b as qe,c as je}from"./VChip-D17pROGK.js";import{u as Fe}from"./tag-CK_kS7XO.js";import{V as J}from"./VSelect-BFp95bnL.js";import{V as Ge}from"./VCheckbox-BpBDLJ7R.js";import{_ as ue}from"./MenuItems-26V-FboC.js";import{V as Be}from"./VToolbar-etY1GidH.js";import{V as Ee}from"./VDataTable-wS0Z7qFU.js";import{V as de}from"./VDialog-DQB8jCa6.js";import{V as Le}from"./VAutocomplete-BfnHmHZq.js";import{V as me}from"./VMenu-nE2mfhDs.js";import{V as Me}from"./VTextarea-B0z77hcG.js";import"./VAvatar-CuprfBP1.js";import"./dimensions-BC2DFC3e.js";import"./ssrBoot-4XNgavEE.js";/* empty css              */import"./filter-au9RQdoW.js";const Je={__name:"FilterSetForm",emits:["close"],setup(V,{emit:U}){const{$gettext:m}=oe(),g=U,n=ne(),a=v({}),k=v(),y=v(!1);function l(){k.value.reset(),a.value={},g("close")}async function A(){const{valid:r}=await k.value.validate();if(r){y.value=!0;try{await F.createFilterSet(a.value),n.displayNotification({msg:m("Filter set created")}),l()}finally{y.value=!1}}}return(r,h)=>(f(),S(Ve,{title:o(m)("Create a new filter set")},{default:p(()=>[e(ve,null,{default:p(()=>[e(ie,{ref_key:"formRef",ref:k},{default:p(()=>[e(K,{modelValue:a.value.name,"onUpdate:modelValue":h[0]||(h[0]=C=>a.value.name=C),label:o(m)("Name"),variant:"outlined",rules:[o(T).required]},null,8,["modelValue","label","rules"]),e(ye,{label:o(m)("Active"),modelValue:a.value.active,"onUpdate:modelValue":h[1]||(h[1]=C=>a.value.active=C),color:"primary"},null,8,["label","modelValue"])]),_:1},512)]),_:1}),e(be),e(pe,null,{default:p(()=>[e(ge),e(_,{text:o(m)("Cancel"),variant:"plain",onClick:l},null,8,["text"]),e(_,{color:"primary",text:o(m)("Create"),onClick:A},null,8,["text"])]),_:1})]),_:1},8,["title"]))}},ze=ce({...De({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),te=fe()({name:"VRadio",props:ze(),setup(V,U){let{slots:m}=U;return Fe(()=>{const g=ae.filterProps(V);return e(ae,M(g,{class:["v-radio",V.class],style:V.style,type:"radio"}),m)}),{}}}),Ke=ce({height:{type:[Number,String],default:"auto"},...Oe(),...Ue(qe(),["multiple"]),trueIcon:{type:re,default:"$radioOn"},falseIcon:{type:re,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Qe=fe()({name:"VRadioGroup",inheritAttrs:!1,props:Ke(),emits:{"update:modelValue":V=>!0},setup(V,U){let{attrs:m,slots:g}=U;const n=Ae(),a=le(()=>V.id||`radio-group-${n}`),k=Re(V,"modelValue");return Fe(()=>{const[y,l]=Ne(m),A=se.filterProps(V),r=ae.filterProps(V),h=g.label?g.label({label:V.label,props:{for:a.value}}):V.label;return e(se,M({class:["v-radio-group",V.class],style:V.style},y,A,{modelValue:k.value,"onUpdate:modelValue":C=>k.value=C,id:a.value}),{...g,default:C=>{let{id:$,messagesId:O,isDisabled:I,isReadonly:x}=C;return e(q,null,[h&&e(Pe,{id:$.value},{default:()=>[h]}),e(je,M(r,{id:$.value,"aria-describedby":O.value,defaultsTarget:"VRadio",trueIcon:V.trueIcon,falseIcon:V.falseIcon,type:V.type,disabled:I.value,readonly:x.value,"aria-labelledby":h?$.value:void 0,multiple:!1},l,{modelValue:k.value,"onUpdate:modelValue":E=>k.value=E}),g)])}})}),{}}}),We={class:"bg-grey-lighten-4 rounded pa-3"},Ze={class:"d-flex align-center"},He={class:"mt-4 bg-grey-lighten-4 rounded pa-3"},Xe={class:"d-flex align-start mt-2"},Ye={class:"mx-2 d-flex flex-column flex-grow-1"},et={__name:"FilterForm",props:{filterSet:{type:String,default:null},filter:{type:Object,required:!1,default:null}},emits:["close"],setup(V,{emit:U}){const m=V,g=U,n=ne(),{$gettext:a}=oe(),k=v({}),y=v([]),l=v([]),A=v(),r=v(x()),h=v(!1),C=le(()=>m.filter?a("Edit filter"):a("New filter")),$=le(()=>m.filter?a("Update"):a("Create"));let O;z(()=>m.filter,c=>{c?(r.value=JSON.parse(JSON.stringify(c)),O=c.name):r.value=x()},{immediate:!0});function I(){g("close"),r.value=x()}function x(){return{match_type:"anyof",conditions:[{}],actions:[{args:{}}]}}function E(c){for(const b of y.value)if(b.name===c)return b.operators;return[]}function Q(c){for(const b of y.value)if(b.name===r.value.conditions[c].name){for(const s of b.operators)if(s.name===r.value.conditions[c].operator)return s.type==="string"?"text":"number"}}function W(c){for(const b of l.value)if(b.name===c)return b.args;return[]}function Z(){r.value.conditions.push({name:y.value[0].name,operator:y.value[0].operators[0].name})}function L(c){r.value.conditions.splice(c,1)}function P(){r.value.actions.push({name:l.value[0].name,args:{}})}function H(c){r.value.actions.splice(c,1)}async function X(){const{valid:c}=await A.value.validate();if(!c)return;h.value=!0;let b;const s=JSON.parse(JSON.stringify(r.value));for(const w of s.actions)for(const[d,R]of Object.entries(w.args))typeof R=="boolean"&&!R&&delete w.args[d];try{m.filter?(await F.updateFilter(m.filterSet,O,s),b=a("Filter updated")):(await F.createFilter(m.filterSet,s),b=a("Filter added"))}catch(w){w.response.status===400&&w.response.data&&(k.value=w.response.data);return}finally{h.value=!1}n.displayNotification({msg:b}),I()}return F.getFilterConditionTemplates().then(c=>{y.value=c.data,m.filter||(r.value.conditions[0].name=y.value[0].name,r.value.conditions[0].operator=y.value[0].operators[0].name)}),F.getFilterActionTemplates().then(c=>{l.value=c.data,m.filter||(r.value.actions[0].name=l.value[0].name)}),(c,b)=>(f(),S(Ve,{title:C.value},{default:p(()=>[e(ve,null,{default:p(()=>[e(ie,{ref_key:"formRef",ref:A},{default:p(()=>[e(K,{modelValue:r.value.name,"onUpdate:modelValue":b[0]||(b[0]=s=>r.value.name=s),label:o(a)("Name"),variant:"outlined",density:"compact",rules:[o(T).required],"error-messages":k.value.name?k.value.name:[]},null,8,["modelValue","label","rules","error-messages"]),D("div",We,[D("h4",null,B(o(a)("Conditions")),1),e(Qe,{modelValue:r.value.match_type,"onUpdate:modelValue":b[1]||(b[1]=s=>r.value.match_type=s),color:"primary",inline:""},{default:p(()=>[e(te,{label:o(a)("All of the following"),value:"allof"},null,8,["label"]),e(te,{label:o(a)("Any of the following"),value:"anyof"},null,8,["label"]),e(te,{label:o(a)("All messages"),value:"all"},null,8,["label"])]),_:1},8,["modelValue"]),r.value.match_type!=="all"?(f(!0),N(q,{key:0},Y(r.value.conditions,(s,w)=>(f(),N("div",Ze,[e(J,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(a)("Choose a header"),items:y.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),e(J,{modelValue:s.operator,"onUpdate:modelValue":d=>s.operator=d,label:o(a)("Choose an operator"),items:E(s.name),"item-title":"label","item-value":"name",variant:"outlined",class:"ml-2",density:"compact",rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),e(K,{modelValue:s.value,"onUpdate:modelValue":d=>s.value=d,label:o(a)("Value"),variant:"outlined",class:"ml-2",density:"compact",type:Q(w),rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","label","type","rules"]),w===0?(f(),S(_,{key:0,icon:"mdi-plus",variant:"text",title:o(a)("Add condition"),color:"primary",onClick:Z},null,8,["title"])):(f(),S(_,{key:1,icon:"mdi-trash-can",variant:"text",title:o(a)("Remove condition"),color:"error",onClick:d=>L(w)},null,8,["title","onClick"]))]))),256)):j("",!0)]),D("div",He,[D("h4",null,B(o(a)("Actions")),1),(f(!0),N(q,null,Y(r.value.actions,(s,w)=>(f(),N("div",Xe,[e(J,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(a)("Choose an action"),items:l.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",class:"flex-grow-0"},null,8,["modelValue","onUpdate:modelValue","label","items"]),D("div",Ye,[(f(!0),N(q,null,Y(W(s.name),d=>(f(),N(q,null,[d.type==="list"?(f(),S(J,{key:0,modelValue:s.args[d.name],"onUpdate:modelValue":R=>s.args[d.name]=R,items:d.choices,"item-title":"label",density:"compact",variant:"outlined",rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])):j("",!0),d.type==="string"?(f(),S(K,{key:1,modelValue:s.args[d.name],"onUpdate:modelValue":R=>s.args[d.name]=R,density:"compact",variant:"outlined",rules:[o(T).required]},null,8,["modelValue","onUpdate:modelValue","rules"])):j("",!0),d.type==="boolean"?(f(),S(Ge,{key:2,modelValue:s.args[d.name],"onUpdate:modelValue":R=>s.args[d.name]=R,label:d.label,color:"primary",value:d.value,density:"compact"},null,8,["modelValue","onUpdate:modelValue","label","value"])):j("",!0)],64))),256))]),w===0?(f(),S(_,{key:0,icon:"mdi-plus",variant:"text",title:o(a)("Add action"),color:"primary",onClick:P},null,8,["title"])):(f(),S(_,{key:1,icon:"mdi-trash-can",variant:"text",title:o(a)("Remove action"),color:"error",onClick:d=>H(w)},null,8,["title","onClick"]))]))),256))])]),_:1},512)]),_:1}),e(be),e(pe,null,{default:p(()=>[e(ge),e(_,{text:o(a)("Cancel"),variant:"elevated",onClick:I},null,8,["text"]),e(_,{color:"primary",variant:"elevated",text:$.value,loading:h.value,onClick:X},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},tt={class:"pa-4"},lt={class:"text-h6 font-weight-regular mb-4"},at={key:0,class:"bg-white mt-4 pa-2"},ot={class:"d-flex align-center"},At={__name:"FiltersView",setup(V){const U=$e(),m=Ie(),g=ne(),{$gettext:n}=oe(),a=v([]),k=v([]),y=v(""),l=v(),A=v(!1),r=v([]),h=v(),C=v(!1),$=v(!1),O=v(null),I=v(!1),x=v(!1),E=[{title:n("Name"),key:"name"},{title:n("Active"),key:"enabled"},{title:"",key:"filter_actions",align:"end"}];z(l,t=>{t?(P(t.name),m.params.filterset!==t.name&&U.push({name:"AccountFilters",params:{filterset:t.name}})):U.push({name:"AccountFilters"})}),z(C,t=>{t?F.downloadFilterSet(l.value.name).then(i=>{y.value=i.data}):P(l.value.name)}),z(y,()=>{r.value.length&&(r.value=[])});function Q(t){let i=t.name;return t.active&&(i+=" ("+n("active")+")"),i}function W(){I.value=!1,L()}function Z(){x.value=!1,O.value=null,P(l.value.name)}function L(){F.getFilterSets().then(t=>{if(a.value=t.data,!l.value&&m.params.filterset){for(const i of a.value)if(i.name===m.params.filterset){l.value=i;break}}})}function P(t){A.value=!0,F.getFilters(t).then(i=>{k.value=i.data,A.value=!1})}function H(t){O.value=t,x.value=!0}function X(t){F.enableFilter(l.value.name,t.name).then(()=>{t.enabled=!0,g.displayNotification({msg:n("Filter enabled")})})}function c(t){F.disableFilter(l.value.name,t.name).then(()=>{t.enabled=!1,g.displayNotification({msg:n("Filter disabled")})})}function b(t){F.deleteFilter(l.value.name,t.name).then(()=>{g.displayNotification({msg:n("Filter removed")}),P(l.value.name)})}async function s(t){await F.moveFilterDown(l.value.name,t.name),P(l.value.name)}async function w(t){await F.moveFilterUp(l.value.name,t.name),P(l.value.name)}async function d(t){await F.activateFilterSet(t.name),g.displayNotification({msg:n("Filter set activated")})}async function R(t){await F.deleteFilterSet(t.name),g.displayNotification({msg:n("Filter set removed")}),l.value=null,L()}async function ke(){const{valid:t}=await h.value.validate();if(!t)return;const i={content:y.value};$.value=!0;try{await F.saveFilterSet(l.value.name,i),g.displayNotification({msg:n("Filter set updated")})}catch(u){u.response.status===400&&u.response.data.content&&(r.value=u.response.data.content)}finally{$.value=!1}}async function he(t){const i=await F.downloadFilterSet(t.name),u=new Blob([i.data],{type:"text/plain"}),G=document.createElement("a");G.href=URL.createObjectURL(u),G.download=`${t.name}.txt`,G.click(),URL.revokeObjectURL(G.href)}const we=[{label:n("Edit"),icon:"mdi-circle-edit-outline",onClick:H},{label:n("Delete"),icon:"mdi-delete-outline",onClick:b,color:"red"}];function Ce(t,i){const u=[...we];return t.enabled?u.push({label:n("Disable"),icon:"mdi-stop",color:"red",onClick:c}):u.push({label:n("Enable"),icon:"mdi-check",color:"success",onClick:X}),i!==k.value.length-1&&u.push({label:n("Move down"),icon:"mdi-arrow-down",onClick:s}),i!==0&&u.push({label:n("Move up"),icon:"mdi-arrow-up",onClick:w}),u}const _e=[{label:n("Download filter set"),icon:"mdi-download",onClick:he},{label:n("Delete filter set"),color:"error",icon:"mdi-trash-can",onClick:R}];function Se(){const t=[];return l.value.active||t.push({label:n("Activate filter set"),color:"success",icon:"mdi-check",onClick:d}),t.concat(_e)}return L(),(t,i)=>(f(),N(q,null,[D("div",tt,[D("div",lt,B(o(n)("Message filters")),1),e(Be,{dense:"",floating:"",color:"white"},{default:p(()=>[e(Le,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=u=>l.value=u),label:o(n)("Select a filter set"),items:a.value,"item-title":Q,"return-object":"",variant:"outlined","hide-details":"",class:"flex-grow-0",style:{width:"200px"},density:"compact"},null,8,["modelValue","label","items"]),e(_,{color:"primary",icon:"mdi-plus",size:"small",class:"mx-4",onClick:i[1]||(i[1]=u=>I.value=!0),title:o(n)("Add filter set")},null,8,["title"]),l.value?(f(),S(me,{key:0},{activator:p(({props:u})=>[e(_,M({icon:"mdi-dots-vertical"},u,{size:"small",color:"default"}),null,16)]),default:p(()=>[e(ue,{items:Se(),obj:l.value},null,8,["items","obj"])]),_:1})):j("",!0),l.value?(f(),S(ye,{key:1,modelValue:C.value,"onUpdate:modelValue":i[2]||(i[2]=u=>C.value=u),label:o(n)("Raw mode"),color:"primary",class:"ml-4","hide-details":""},null,8,["modelValue","label"])):j("",!0)]),_:1}),l.value?(f(),N("div",at,[C.value?(f(),N(q,{key:1},[e(ie,{ref_key:"rawFormRef",ref:h},{default:p(()=>[e(Me,{modelValue:y.value,"onUpdate:modelValue":i[4]||(i[4]=u=>y.value=u),variant:"outlined","auto-grow":"",rules:[o(T).required],"error-messages":r.value},null,8,["modelValue","rules","error-messages"])]),_:1},512),e(_,{color:"success",onClick:ke,loading:$.value,class:"mt-2"},{default:p(()=>[ee(B(o(n)("Save")),1)]),_:1},8,["loading"])],64)):(f(),N(q,{key:0},[D("div",ot,[e(_,{color:"primary",title:o(n)("Add new filter"),onClick:i[3]||(i[3]=u=>x.value=!0),class:"mx-auto"},{default:p(()=>[e(Te,{icon:"mdi-plus"}),ee(" "+B(o(n)("Add")),1)]),_:1},8,["title"])]),e(Ee,{headers:E,items:k.value,loading:A.value},{"item.enabled":p(({item:u})=>[ee(B(t.$yesno(u.enabled)),1)]),"item.filter_actions":p(({index:u,item:G})=>[e(me,{"offset-y":""},{activator:p(({props:xe})=>[e(_,M({icon:"mdi-dots-horizontal",variant:"text"},xe),null,16)]),default:p(()=>[e(ue,{items:Ce(G,u),obj:G},null,8,["items","obj"])]),_:2},1024)]),_:2},1032,["items","loading"])],64))])):j("",!0)]),e(de,{modelValue:I.value,"onUpdate:modelValue":i[5]||(i[5]=u=>I.value=u),"max-width":"600"},{default:p(()=>[e(Je,{onClose:W})]),_:1},8,["modelValue"]),e(de,{modelValue:x.value,"onUpdate:modelValue":i[6]||(i[6]=u=>x.value=u),"max-width":"800"},{default:p(()=>[l.value?(f(),S(et,{key:0,"filter-set":l.value.name,filter:O.value,onClose:Z},null,8,["filter-set","filter"])):j("",!0)]),_:1},8,["modelValue"])],64))}};export{At as default};
