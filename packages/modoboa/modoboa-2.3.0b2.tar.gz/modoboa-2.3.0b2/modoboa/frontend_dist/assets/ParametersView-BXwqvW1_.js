import{_ as A,b as I,a2 as z,q as W,U as j,h as m,z as T,B as U,o as s,X as i,a as d,w as n,j as C,t as h,R as p,Z as _,c,W as R,Y as q,e as D}from"./index-B6sfQZUh.js";import{p as g}from"./parameters-OYesQCoR.js";import{V as G,a as L}from"./VToolbar-i9pq53Nj.js";import{V as M,a as O,b as X,c as Y}from"./VTabs-DD6KX9Qj.js";import{V as Z}from"./VImg-AVVNtsoJ.js";import{c as $,a as H}from"./VCard-CKOt35J8.js";import{V as J}from"./VSwitch-Bvl549Dr.js";import{V as K}from"./VSelect-B9nLCGKh.js";import{V as Q}from"./VTextField-xrmh1FWy.js";import"./tag-wMOM-gqO.js";import"./forwardRefs-DWGaNmQL.js";import"./VWindowItem-d1FqDlD3.js";import"./lazy-YEt_kfmk.js";import"./ssrBoot-CPdEBhNq.js";import"./VChip-CRYOXnOA.js";import"./VField-Bhyg59H4.js";import"./dimensions-CKYnSDDa.js";import"./VAvatar-xee8L3pJ.js";import"./VOverlay-GMQTQL34.js";import"./createSimpleFunctional-BdzT111U.js";import"./VList-BoxPhnZ6.js";import"./dialog-transition-InZxhk0f.js";import"./VMenu-uuonQ6o9.js";const ee={key:0},te={class:"m-label"},ae={__name:"ParametersView",setup(le){const{$gettext:y}=I(),w=z(),f=W(),F=j(),v=m(0),V=m([]),r=m({}),u=m({}),k=m(""),b=m([]),x=T(()=>V.value.filter(l=>S(l))),P=T(()=>y("Settings: "+k.value));function B(l){g.getApplicationStructure(l).then(t=>{V.value=t.data}),g.getApplication(l).then(t=>{r.value=t.data.params,k.value=t.data.label})}function S(l){if(l.display==="")return!0;let t=!0;return l.display.split("&").forEach(a=>{let[e,o]=a.split("=");(o==="true"||o==="false")&&(o=!!o),t&=r.value[e]===o}),t}function E(l){return l.filter(t=>S(t))}async function N(){u.value={},b.value=[],g.saveApplication(f.params.app,r.value).then(()=>{w.displayNotification({msg:y("Parameters updated")}),f.params.app==="imap_migration"&&(F.imapMigrationEnabled=r.value.enabled_imapmigration)}).catch(l=>{w.displayNotification({msg:y("Could not save parameters"),type:"error"}),u.value=l.response.data,Object.keys(u.value).forEach(t=>{for(let a=0;a<V.value.length;a++)V.value[a].parameters.filter(o=>o.name===t).length>0&&b.value.push(a)})})}return U(f,l=>{B(l.params.app)}),U(r,()=>{b.value=[]}),B(f.params.app),(l,t)=>(s(),i("div",null,[d(G,{flat:""},{default:n(()=>[d(L,null,{default:n(()=>[C(h(P.value),1)]),_:1})]),_:1}),d(M,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),"bg-color":"white"},{default:n(()=>[(s(!0),i(p,null,_(x.value,(a,e)=>(s(),c(X,{key:e,color:"primary",class:R(b.value.includes(e)?"error_tab":"")},{default:n(()=>[C(h(a.label),1)]),_:2},1032,["class"]))),128))]),_:1},8,["modelValue"]),d(O,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=a=>v.value=a)},{default:n(()=>[(s(!0),i(p,null,_(x.value,a=>(s(),c(Y,{key:a.label},{default:n(()=>[d($,null,{default:n(()=>[d(H,null,{default:n(()=>[(s(!0),i(p,null,_(E(a.parameters),e=>(s(),i("div",{key:e.name,class:"my-4"},[e.widget==="SeparatorField"?(s(),i("h2",ee,h(e.label),1)):e.widget==="BooleanField"?(s(),i(p,{key:1},[e.widget==="BooleanField"?(s(),c(J,{key:0,modelValue:r.value[e.name],"onUpdate:modelValue":o=>r.value[e.name]=o,label:e.label,hint:e.help_text,error:u.value[e.name]!==void 0,color:"primary",density:"compact","error-messages":u.value[e.name],"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","hint","error","error-messages"])):q("",!0)],64)):(s(),i(p,{key:2},[D("label",te,h(e.label),1),e.widget==="ChoiceField"?(s(),c(K,{key:0,modelValue:r.value[e.name],"onUpdate:modelValue":o=>r.value[e.name]=o,items:e.choices,"item-title":"text",hint:e.help_text,"persistent-hint":"",density:"compact",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items","hint"])):(s(),c(Q,{key:1,modelValue:r.value[e.name],"onUpdate:modelValue":o=>r.value[e.name]=o,hint:e.help_text,"persistent-hint":"",error:u.value[e.name]!==void 0,"error-messages":u.value[e.name],type:e.widget==="PasswordField"?"password":"text",density:"compact",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","hint","error","error-messages","type"]))],64))]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["modelValue"]),d(Z,{icon:"mdi-content-save",class:"ma-5",position:"fixed",location:"bottom right",color:"green",size:"large",onClick:N})]))}},Te=A(ae,[["__scopeId","data-v-224504f5"]]);export{Te as default};
