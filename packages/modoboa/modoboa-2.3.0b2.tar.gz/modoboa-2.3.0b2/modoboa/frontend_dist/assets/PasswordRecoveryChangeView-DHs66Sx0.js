import{_ as U}from"./Modoboa_RVB-BLANC-SANS-BbMFcwZs.js";import{b as D,h as u,q as I,g as N,r as T,o as g,c as V,w as o,a as s,n as $,e as d,t as c,f as r,j as C,p as A,m as K}from"./index-B6sfQZUh.js";import{V as L,r as y}from"./VForm-CVtiyeDB.js";import{a as F,V as x}from"./VRow-DllmF7yv.js";import{V as R}from"./VTextField-xrmh1FWy.js";import{V as S,a as z}from"./VImg-AVVNtsoJ.js";import{V as E}from"./VContainer-D_MLw6yn.js";import"./tag-wMOM-gqO.js";import"./VField-Bhyg59H4.js";import"./forwardRefs-DWGaNmQL.js";/* empty css              */import"./dimensions-CKYnSDDa.js";const G={class:"text-primary mb-6 text-h4"},H={id:"password_validation"},J={class:"m-label"},M={class:"d-flex justify-center"},P={__name:"PasswordRecoveryChangeForm",setup(j){const{$gettext:a}=D(),n=u(!1),i=u(""),_=u(""),v=u(""),p=I(),m=N(),k=u(null);let w,h;function q(){if(p.params.token===void 0)(w===""||h==="")&&m.push({name:"PasswordRecovery"});else{const f=atob(p.params.id);/^\d+$/.test(f)?(h=p.params.id,w=p.params.token,m.push({name:"PasswordRecoveryChangeForm"})):m.push({name:"PasswordRecovery"})}}async function b(){const{valid:f}=await k.value.validate();if(!f)return;const l={new_password1:i.value,new_password2:_.value,token:w,id:h};n.value=!0,v.value="",A.changePassword(l).then(t=>{t.status===200&&(n.value=!1,m.push({name:"Login"}))}).catch(t=>{let e="";n.value=!1,t.response.status===403?e=a("Invalid reset token."):t.response.status===404?e=a("User unknown."):t.response.status===400&&t.response.data.type==="password_requirement"?t.response.data.errors.forEach(B=>{e+=a(B)+"<br>"}):t.response.status===429&&(e=a("Too many unsuccessful attempts, please try later.")),v.value=e})}return q(),(f,l)=>{const t=T("router-link");return g(),V(E,{class:"fill-height",fluid:""},{default:o(()=>[s(F,{align:"center",justify:"center"},{default:o(()=>[s(x,{cols:"12",sm:"6",class:"d-flex flex-column justify-center pa-10",onKeyup:$(b,["enter"])},{default:o(()=>[d("h4",G,c(r(a)("Forgot password?")),1),s(L,{ref_key:"observer",ref:k},{default:o(()=>[d("p",H,c(v.value),1),d("label",J,c(r(a)("Change password")),1),s(R,{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value=e),type:"password",variant:"outlined",rules:[r(y).required]},null,8,["modelValue","rules"]),s(R,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=e=>_.value=e),type:"password",variant:"outlined",rules:[r(y).required,e=>r(y).samePassword(e,i.value)]},null,8,["modelValue","rules"])]),_:1},512),d("div",M,[s(S,{class:"flex-grow-1",color:"primary",size:"large",loading:n.value,onClick:b},{default:o(()=>[C(c(r(a)("Submit")),1)]),_:1},8,["loading"])]),d("div",null,[s(t,{to:{name:"Login"},class:"float-right text-primary"},{default:o(()=>[C(c(r(a)("Return to login")),1)]),_:1})])]),_:1})]),_:1})]),_:1})}}},le={__name:"PasswordRecoveryChangeView",setup(j){const{smAndDown:a}=K();return(n,i)=>r(a)?(g(),V(P,{key:0})):(g(),V(F,{key:1,class:"fill-height ma-0"},{default:o(()=>[s(x,{class:"bg-primary"},{default:o(()=>[s(z,{src:U,"max-width":"300",class:"mt-10 ml-8"})]),_:1}),s(x,{class:"text-center"},{default:o(()=>[s(P)]),_:1})]),_:1}))}};export{le as default};
