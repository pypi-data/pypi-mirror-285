import{g as I,b as P,u as J,a6 as M,z as U,h as p,d as z,f as u,o as s,c as d,X as v,a,w as e,j as c,t as o,e as _,Y as L,q as K}from"./index-B6sfQZUh.js";import{_ as Q,a as X,b as Y,c as H}from"./DomainTransportForm-DThdo27L.js";import{L as W}from"./LoadingData-XKoiHIys.js";import{p as Z}from"./parameters-OYesQCoR.js";import{_ as ee}from"./ResourcesForm-CmV3rKxV.js";import{w as $,i as E,V as O}from"./VImg-AVVNtsoJ.js";import{V as h,c as F,a as x,b as ae}from"./VExpansionPanels-CVe8KlbO.js";import{a as f,V as i}from"./VRow-DllmF7yv.js";import"./ChoiceField-DMrzS-DT.js";import"./VForm-CVtiyeDB.js";import"./tag-wMOM-gqO.js";import"./VField-Bhyg59H4.js";import"./forwardRefs-DWGaNmQL.js";import"./VTextField-xrmh1FWy.js";import"./dimensions-CKYnSDDa.js";import"./VSwitch-Bvl549Dr.js";import"./VChip-CRYOXnOA.js";import"./VAvatar-xee8L3pJ.js";import"./VAutocomplete-D7qVHjLV.js";import"./VSelect-B9nLCGKh.js";import"./VList-BoxPhnZ6.js";import"./ssrBoot-CPdEBhNq.js";import"./createSimpleFunctional-BdzT111U.js";import"./dialog-transition-InZxhk0f.js";import"./VMenu-uuonQ6o9.js";import"./VOverlay-GMQTQL34.js";import"./lazy-YEt_kfmk.js";import"./filter-CcSZdtpY.js";import"./VCheckbox-CAjAGN0I.js";import"./VContainer-D_MLw6yn.js";/* empty css              */const te={key:1},le={key:0},oe={key:0},se={key:0},ue={class:"mr-2"},re={class:"mr-2"},ne={class:"mr-2"},ie={key:0},me={class:"mr-2"},de={class:"mt-4 d-flex justify-end"},ce={__name:"DomainEditForm",props:{domain:{type:Object,default:null}},setup(C){const S=I(),{$gettext:r}=P(),b=J(),y=M(),w=C,g=U(()=>b.authUser),k=p({}),D=p(0),V=p(!1),l=U(()=>w.domain),T=p(),A=p(),R=p(),B=p(),j=p(),q=U(()=>{const m={generalForm:T,limitationForm:B,dnsForm:j};return l.value.type==="relaydomain"&&(m.transportForm=R),k.value.params&&k.value.params.enable_domain_limits&&(g.value.role==="SuperAdmins"||g.value.role==="Resellers")&&(m.resourcesForm=A),m}),N=p(!1);async function G(){N.value=!1,D.value=[];for(const[m,n]of Object.entries(q.value))if(n.value!=null){const{valid:t}=await n.value.vFormRef.validate();t||(N.value=!0,D.value.push(m))}if(!N.value){V.value=!0;try{const m=JSON.parse(JSON.stringify(l.value));m.transport===null&&delete m.transport,m.type==="relaydomain"&&R.value.checkSettingTypes(m),y.updateDomain(m).then(()=>{S.go(-1)})}finally{V.value=!1}}}return z(()=>{Z.getApplication("limits").then(m=>{k.value.data=m.data})}),(m,n)=>!u(y).domainsLoaded||V.value?(s(),d(W,{key:0})):(s(),v("div",te,[a(ae,{modelValue:D.value,"onUpdate:modelValue":n[5]||(n[5]=t=>D.value=t),multiple:N.value},{default:e(()=>[a(h,{eager:"",value:"generalForm"},{default:e(()=>[a(F,null,{default:e(({expanded:t})=>[a(f,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("General")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a($,{"leave-absolute":""},{default:e(()=>[t?(s(),v("span",le)):(s(),d(f,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("Name: "))+" "+o(l.value.name),1)]),_:1}),a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("Type: "))+" "+o(l.value.type),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(Q,{ref_key:"generalForm",ref:T,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(h,{eager:"",value:"dnsForm"},{default:e(()=>[a(F,null,{default:e(({expanded:t})=>[a(f,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("DNS")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a($,{"leave-absolute":""},{default:e(()=>[t?(s(),v("span",oe)):(s(),d(f,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("DNS checks"))+" ",1),l.value.enable_dns_checks?(s(),d(E,{key:0,color:"success",icon:"mdi-check-circle-outline"})):(s(),d(E,{key:1,icon:"mdi-check-circle-outline"}))]),_:1}),a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("DKIM signing"))+" ",1),l.value.enable_dkim?(s(),d(E,{key:0,color:"success",icon:"mdi-check-circle-outline"})):(s(),d(E,{key:1,icon:"mdi-close-circle-outline"}))]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(X,{ref_key:"dnsForm",ref:j,modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(h,{eager:"",value:"limitationForm"},{default:e(()=>[a(F,null,{default:e(({expanded:t})=>[a(f,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Limitations")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a($,{"leave-absolute":""},{default:e(()=>[t?(s(),v("span",se)):(s(),d(f,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[_("div",ue,o(u(r)("Quota: "))+" "+o(l.value.quota),1)]),_:1}),l.value.message_limit?(s(),d(i,{key:0,cols:"6"},{default:e(()=>[_("div",re,o(u(r)("Sending limit: "))+" "+o(l.value.message_limit),1)]),_:1})):(s(),d(i,{key:1,cols:"6"},{default:e(()=>[_("div",ne,o(u(r)("No sending limit")),1)]),_:1}))]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(Y,{ref_key:"limitationForm",ref:B,modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),l.value.type==="relaydomain"?(s(),d(h,{key:0,value:"transportForm",eager:""},{default:e(()=>[a(F,null,{default:e(({expanded:t})=>[a(f,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Transport")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a($,{"leave-absolute":""},{default:e(()=>[t?(s(),v("span",ie)):(s(),d(f,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[_("div",me,o(u(r)("Service: "))+" "+o(l.value.transport.service),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(H,{ref_key:"transportForm",ref:R,modelValue:l.value.transport,"onUpdate:modelValue":n[3]||(n[3]=t=>l.value.transport=t)},null,8,["modelValue"])]),_:1})]),_:1})):L("",!0),k.value.params&&k.value.params.enable_domain_limits&&(g.value.role==="SuperAdmins"||g.value.role==="Resellers")?(s(),d(h,{key:1,value:"resourcesForm",eager:""},{default:e(()=>[a(F,null,{default:e(()=>[a(f,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Resources")),1)]),_:1})]),_:1})]),_:1}),a(x,null,{default:e(()=>[a(ee,{ref_key:"resourcesForm",ref:A,modelValue:l.value.resources,"onUpdate:modelValue":n[4]||(n[4]=t=>l.value.resources=t)},null,8,["modelValue"])]),_:1})]),_:1})):L("",!0)]),_:1},8,["modelValue","multiple"]),_("div",de,[a(O,{loading:V.value,onClick:n[6]||(n[6]=t=>u(S).go(-1))},{default:e(()=>[c(o(u(r)("Cancel")),1)]),_:1},8,["loading"]),a(O,{class:"ml-4",color:"primary darken-1",loading:V.value,onClick:G},{default:e(()=>[c(o(u(r)("Save")),1)]),_:1},8,["loading"])])]))}},pe={class:"text-h4"},fe=_("div",{class:"mt-4"},null,-1),ze={__name:"DomainEditView",setup(C){const{$gettext:S}=P(),r=M(),b=K(),y=p({pk:b.params.id});return r.getDomain(b.params.id).then(w=>y.value=w.data),(w,g)=>(s(),v("div",null,[_("span",pe,o(u(S)("Edit domain")),1),fe,a(u(ce),{domain:y.value},null,8,["domain"])]))}};export{ze as default};
