import{b as j,aw as z,ah as G,q as X,g as Y,h as _,z as C,d as H,B as J,f as n,o,c as m,X as p,a,w as e,j as c,t as s,e as f,R as B,Y as y}from"./index-B6sfQZUh.js";import{_ as K,a as W,A as Z,b as ee}from"./AccountAliasForm-CEvL8iZm.js";import{_ as ae}from"./ResourcesForm-CmV3rKxV.js";import{L as le}from"./LoadingData-XKoiHIys.js";import{p as te}from"./parameters-OYesQCoR.js";import{w as k,i as E,V as T}from"./VImg-AVVNtsoJ.js";import{V as g,c as V,a as b,b as se}from"./VExpansionPanels-CVe8KlbO.js";import{a as v,V as i}from"./VRow-DllmF7yv.js";import"./ChoiceField-DMrzS-DT.js";import"./VAlert-ID3jq3-b.js";import"./createSimpleFunctional-BdzT111U.js";import"./tag-wMOM-gqO.js";import"./dimensions-CKYnSDDa.js";import"./VForm-CVtiyeDB.js";import"./VField-Bhyg59H4.js";import"./forwardRefs-DWGaNmQL.js";import"./AccountPasswordSubForm-Ci-suAbr.js";import"./VTextField-xrmh1FWy.js";import"./VSwitch-Bvl549Dr.js";import"./VChip-CRYOXnOA.js";import"./VAvatar-xee8L3pJ.js";import"./EmailField-Dp8XKnJi.js";import"./VList-BoxPhnZ6.js";import"./ssrBoot-CPdEBhNq.js";import"./VContainer-D_MLw6yn.js";/* empty css              */import"./lazy-YEt_kfmk.js";const oe={key:1},ue={key:0},re={key:0},ne={class:"mr-2"},ie={class:"mr-2"},de={key:0},me={class:"mr-2"},ce={class:"mr-2"},fe={class:"mr-2"},_e={key:0},ve={class:"mr-2"},pe={key:0},ye={class:"mr-2"},xe={class:"mr-2"},ke={class:"mt-4 d-flex justify-end"},ge={__name:"AccountEditForm",setup(q){const{$gettext:r}=j(),$=z(),M=G(),S=X(),D=Y(),l=_({pk:S.params.id}),h=C(()=>l.value.username&&l.value.role!=="SuperAdmins"&&l.value.username.indexOf("@")!==-1),N=C(()=>{const t=R.value.params&&R.value.params.enable_admin_limits&&l.value.role!=="SimpleUsers"&&l.value.role!=="SuperAdmins";return t===void 0?!1:t}),R=_({}),F=_(0),x=_(!1),w=_(!1),U=_(),I=_(),P=_(),L=_(),A=_(),O=C(()=>{const t={roleForm:U,generalForm:I};return h.value&&(t.aliasForm=L,t.mailboxForm=P),N.value&&(t.resourcesForm=A),t});async function Q(){w.value=!1,F.value=[];for(const[t,d]of Object.entries(O.value))if(d.value!=null){const{valid:u}=await d.value.vFormRef.validate();u||(w.value=!0,F.value.push(t))}if(!w.value){x.value=!0;try{const t={...l.value};h.value?t.mailbox.full_address=t.username:delete t.mailbox.full_address,t.password||(delete t.password,delete t.password_confirmation),N.value&&A.value!==null&&(t.resources=A.value.getPayload()),t.aliases===null&&delete t.aliases,M.updateIdentity("account",t).then(()=>{D.push({name:"AccountDetail",params:{id:S.params.id}})})}finally{x.value=!1}}}return H(()=>{$.getAccount(S.params.id).then(t=>l.value={...t.data}),te.getApplication("limits").then(t=>{R.value=t.data})}),J(l,()=>{delete l.value.domains,l.value.mailbox===null&&delete l.value.mailbox},{deep:!0}),(t,d)=>!n($).accountsLoaded||x.value?(o(),m(le,{key:0})):(o(),p("div",oe,[a(se,{modelValue:F.value,"onUpdate:modelValue":d[5]||(d[5]=u=>F.value=u),multiple:w.value},{default:e(()=>[a(g,{eager:"",value:"roleForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(v,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(s(n(r)("Role")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(k,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",ue)):(o(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[c(s(U.value.roleLabel),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(K,{ref_key:"roleForm",ref:U,modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1}),a(g,{eager:"",value:"generalForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(v,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(s(n(r)("Identification")),1)]),_:1}),a(i,{cols:"8",class:"text-secondary"},{default:e(()=>[a(k,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",re)):(o(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[f("div",ne,s(n(r)("Username:"))+" "+s(l.value.username),1)]),_:1}),a(i,{cols:"6"},{default:e(()=>[f("div",ie,[c(s(n(r)("Enabled"))+" ",1),l.value.is_active?(o(),m(E,{key:0,color:"success"},{default:e(()=>[c("mdi-check-circle-outline")]),_:1})):(o(),m(E,{key:1},{default:e(()=>[c("mdi-close-circle-outline")]),_:1}))])]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(W,{ref_key:"generalForm",ref:I,modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=u=>l.value=u),editing:""},null,8,["modelValue"])]),_:1})]),_:1}),h.value?(o(),m(g,{key:0,eager:"",value:"mailboxForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(v,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(s(n(r)("Mailbox")),1)]),_:1}),a(i,{cols:"8",class:"text-secondary"},{default:e(()=>[a(k,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",de)):(o(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.mailbox?(o(),p(B,{key:0},[l.value.mailbox.use_domain_quota?(o(),m(i,{key:0,cols:"6"},{default:e(()=>[f("div",me,s(n(r)("Quota: "))+" "+s(n(r)("domain's default value")),1)]),_:1})):(o(),m(i,{key:1,cols:"6"},{default:e(()=>[f("div",ce,s(n(r)("Quota: "))+" "+s(l.value.mailbox.quota),1)]),_:1})),a(i,{cols:"6"},{default:e(()=>[f("div",fe,[c(s(n(r)("Send only"))+" ",1),l.value.mailbox.is_send_only?(o(),m(E,{key:0,color:"success"},{default:e(()=>[c("mdi-check-circle-outline")]),_:1})):(o(),m(E,{key:1},{default:e(()=>[c("mdi-close-circle-outline")]),_:1}))])]),_:1})],64)):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(Z,{ref_key:"mailboxForm",ref:P,modelValue:l.value,"onUpdate:modelValue":d[2]||(d[2]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0),h.value?(o(),m(g,{key:1,eager:"",value:"aliasForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(v,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(s(n(r)("Alias")),1)]),_:1}),a(i,{cols:"8",class:"text-secondary"},{default:e(()=>[a(k,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",_e)):(o(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.aliases?(o(),m(i,{key:0,cols:"6"},{default:e(()=>[f("div",ve,s(n(r)("Aliases:"))+" "+s(n(r)("Number of associated alias:"))+" "+s(l.value.aliases.length),1)]),_:1})):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(ee,{ref_key:"aliasForm",ref:L,modelValue:l.value,"onUpdate:modelValue":d[3]||(d[3]=u=>l.value=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0),N.value?(o(),m(g,{key:2,eager:"",value:"resourcesForm"},{default:e(()=>[a(V,null,{default:e(({expanded:u})=>[a(v,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(s(n(r)("Resources")),1)]),_:1}),a(i,{cols:"8",class:"text-secondary"},{default:e(()=>[a(k,{"leave-absolute":""},{default:e(()=>[u?(o(),p("span",pe)):(o(),m(v,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[l.value.resources!=null&&l.value.resources.length==2?(o(),p(B,{key:0},[a(i,{cols:"6"},{default:e(()=>[f("div",ye,s(n(r)("Mailbox:"))+" "+s(n(r)("Number of allowed mailboxes:"))+" "+s(l.value.resources[0].max_value),1)]),_:1}),a(i,{cols:"6"},{default:e(()=>[f("div",xe,s(n(r)("Mailbox aliases:"))+" "+s(n(r)("Number of allowed mailbox aliases:"))+" "+s(l.value.resources[1].max_value),1)]),_:1})],64)):y("",!0)]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(b,null,{default:e(()=>[a(ae,{ref_key:"resourcesForm",ref:A,modelValue:l.value.resources,"onUpdate:modelValue":d[4]||(d[4]=u=>l.value.resources=u)},null,8,["modelValue"])]),_:1})]),_:1})):y("",!0)]),_:1},8,["modelValue","multiple"]),f("div",ke,[a(T,{loading:x.value,onClick:d[6]||(d[6]=u=>t.$router.go(-1))},{default:e(()=>[c(s(n(r)("Cancel")),1)]),_:1},8,["loading"]),a(T,{class:"ml-4",color:"primary darken-1",loading:x.value,onClick:Q},{default:e(()=>[c(s(n(r)("Save")),1)]),_:1},8,["loading"])])]))}},Ve={class:"text-h4"},be=f("div",{class:"mt-4"},null,-1),Je={__name:"AccountEditView",setup(q){const{$gettext:r}=j();return($,M)=>(o(),p(B,null,[f("span",Ve,s(n(r)("Edit account")),1),be,a(ge)],64))}};export{Je as default};
