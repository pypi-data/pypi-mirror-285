"use strict";(self.webpackChunkvp4jl=self.webpackChunkvp4jl||[]).push([[586],{1268:(e,t,n)=>{n.r(t),n.d(t,{default:()=>le});var o,s,i,a=n(5295),r=n(2427),d=n(6724),l=n(8686),c=n(6730),u=n(83),h=n(1179),m=n(3793),p=n(5695),v=n(4882),g=n(6029),C=n.n(g),_=n(7573);n(7376);class f extends h.ReactWidget{constructor(e,t){super(),this._editor_activated=!1,this.id=e,this._model=t,this._model.vpContentChanged.connect(this.update,this)}get model(){return this._model}activate(){this._editor_activated||(this._editor_activated=!0,this.update())}deactivate(){this._editor_activated&&(this._editor_activated=!1,this.update())}_updateToolbar(){["copy","paste","cut","duplicate","delete"].forEach((e=>{this.model.toolbarItems[e].widget.update()}))}render(){return C().createElement(_.VPEditor,{id:this.id,content:this._model.vpContent,onContentChange:this._model.setVpContent.bind(this._model),activated:this._editor_activated,onSceneActionsInit:this._model.setVpActions.bind(this._model),onSelectionChange:this._updateToolbar.bind(this)})}}class b extends h.ReactWidget{constructor(e,t,n,o){super(),this.icon=e,this.label=t,this.tooltip=n,this.onClick=o}render(){return C().createElement(c.ToolbarButtonComponent,{icon:this.icon,label:this.label,tooltip:this.tooltip,onClick:this.onClick})}}class y extends c.Toolbar{constructor(){super(),this.addClass("jp-vp-output-area-toolbar"),this._createToolbarItems()}_createToolbarItems(){var e;this.addItem("spacer",c.Toolbar.createSpacerItem()),this.addItem("clear",(e=()=>{var e;return null===(e=this.parent)||void 0===e?void 0:e.clear()},new b(c.clearIcon,"Clear","Clear the output window",e))),this.addItem("close",function(e){return new b(c.closeIcon,"Close","Close the output window",e)}((()=>{var e;return null===(e=this.parent)||void 0===e?void 0:e.hide()})))}}class x extends h.MainAreaWidget{constructor(e,t,n){super({content:new p.OutputArea({rendermime:t.rendermime,model:t.outputAreaModel}),toolbar:new y}),this.sessionContext=n,this.id=e+"output",this.addClass("jp-vp-output-area"),this.title.label="Output"}showErrorMsg(e){this.content.model.clear(),this.content.model.add({output_type:"error",ename:"Error",evalue:e,traceback:[]})}execute(e){p.OutputArea.execute(e,this.content,this.sessionContext).catch((e=>{this.showErrorMsg(e.message)}))}clear(){this.content.model.clear()}toggleOutput(){this.isHidden?this.show():this.hide()}}class w extends v.SplitPanel{constructor(e,t,n){super({orientation:"vertical",spacing:1}),this._model=void 0,this.id=e+"panel",this._model=t,this._sessionContext=n,this.addClass("jp-vp-main-area-panel"),this._vpEditor=new f(e,t),this.addWidget(this._vpEditor),this._outputArea=new x(e,t,n),this.addWidget(this._outputArea),this.setRelativeSizes([4,1])}activate(){this._vpEditor&&this._vpEditor.activate()}deactivate(){this._vpEditor&&this._vpEditor.deactivate()}execute(){var e,t;const n=null===(t=null===(e=this._model)||void 0===e?void 0:e.vpActions)||void 0===t?void 0:t.sourceCode();n&&(n.messages.length>0?this._outputArea.showErrorMsg(n.messages[0].message):this._outputArea.execute(n.code))}toggleOutput(){this._outputArea.toggleOutput()}get sessionContext(){return this._sessionContext}}class E extends m.DocumentWidget{constructor(e,t){super({context:t,content:new w(e,t.model,t.sessionContext)}),this.title.iconClass="jp-VPIcon",this.title.caption="Visual Programming",this.addClass("jp-VPWidget"),this.toolbar.addClass("jp-vp-toolbar"),this.context.ready.then(this._onContextReady.bind(this)),this.model.kernelSpecChanged.connect(this._changeKernel,this),this.sessionContext.kernelChanged.connect(this._setModelKernelSpec,this),this.context.saveState.connect(this._onSave,this)}get model(){return this.context.model}get sessionContext(){return this.context.sessionContext}execute(){this.content.execute()}toggleOutput(){this.content.toggleOutput()}_onContextReady(){this.sessionContext.kernelPreference={canStart:!0,shouldStart:!0,autoStartDefault:!1,shutdownOnDispose:!1}}async _changeKernel(e,t){t&&this.sessionContext.changeKernel(t)}_setModelKernelSpec(e,t){this.model.setKernelSpec(t.newValue)}_onSave(e,t){"started"===t&&this.model&&this.model.saveOutputModel()}}(s=o||(o={})).fileExtension=".vp4jl",s.fileType="vp4jl",s.trackerNamespace="vp4jl",s.widgetFactory="vp4jl widget factory",s.modelFactory="vp4jl model factory",s.createNewLabelInPalette="New Visual Programming File",s.createNewLabelInFileMenu="Visual Programming File",s.createNewLabelInContextMenu="Visual Programming File",s.caption="Create a new Visual Programming file",s.nodeExtension="vp4jl-node-extension",function(e){e.commandCategory="Visual Programming",e.createNew="vp4jl:create-new",e.run="vp4jl:run",e.copy="vp4jl:copy",e.paste="vp4jl:paste",e.del="vp4jl:delete",e.cut="vp4jl:cut",e.duplicate="vp4jl:duplicate",e.deleteAll="vp4jl:clear",e.clearOutput="vp4jl:clear-output",e.shutdownKernel="vp4jl:shutdown-kernel",e.interruptKernel="vp4jl:interrupt-kernel",e.restartKernel="vp4jl:restart-kernel",e.reconnectKernel="vp4jl:reconnect-kernel",e.changeKernel="vp4jl:change-kernel",e.restartKernelAndRun="vp4jl:restart-kernel-and-run",e.showNodeExtension="vp4jl:show-node-extension",e.hideNodeExtension="vp4jl:hide-node-extension",e.toggleNodeExtension="vp4jl:toggle-node-extension",e.toggleOutput="vp4jl:toggle-output"}(i||(i={}));var k=n(9850),S=n(3256);async function M(e="",t={}){const n=S.ServerConnection.makeSettings(),o=k.URLExt.join(n.baseUrl,"vp4jl",e);let s;try{s=await S.ServerConnection.makeRequest(o,t,n)}catch(e){throw new S.ServerConnection.NetworkError(e)}let i=await s.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",s)}if(!s.ok)throw new S.ServerConnection.ResponseError(s,i.message||i);return i}var N=n(7930);function A(){const e={authenticated:!1,Authorization:null,"X-XSRFToken":null},t=S.ServerConnection.makeSettings();if(t.token&&(e.authenticated=!0,e.Authorization=`token ${t.token}`),"undefined"!=typeof document&&(null===document||void 0===document?void 0:document.cookie)){const t=function(e){const t=document.cookie.match("\\b_xsrf=([^;]*)\\b");return null==t?void 0:t[1]}();void 0!==t&&(e.authenticated=!0,e["X-XSRFToken"]=t)}return e}function I({fetching:e,onInstallNodeExtension:t,uninstallNodeExtension:n,enableNodeExtension:o,url:s}){return C().createElement(C().Fragment,null,C().createElement(_.Progress,{enable:e}),C().createElement(_.NodeLibraryList,{title:"INSTALLED",nodeExtensions:{..._.nodeConfigRegistry.getAllNodeConfigs()},onInstall:t,onUninstall:e=>{n(e)},onDisable:e=>{o(e,!1)},onEnable:e=>{o(e,!0)},url:s,tokens:A()}))}class j extends h.ReactWidget{constructor(){super(),this.fetching=!1,this.settings=S.ServerConnection.makeSettings(),this.requestUrl=k.URLExt.join(this.settings.baseUrl,"vp4jl","node_extension_manager"),this.id=o.nodeExtension,this.node.style.background="var(--jp-layout-color1)",this.title.icon=c.extensionIcon,this.title.caption="Node Extension Manager",this.addClass("jp-NodeExtension"),this.addClass("lm-StackedPanel-child"),this.addClass("p-StackedPanel-child")}installNodeExtension(e){const t=JSON.parse(e);for(const e in t.packages)(0,_.LoadPackageToRegistry)(e,t.packages[e]);this.update()}uninstallNodeExtension(e){this.fetching=!0,this.update(),M("node_extension_manager",{method:"DELETE",body:JSON.stringify(e)}).then((t=>{"ok"===t.status&&(_.nodeConfigRegistry.removeNodeConfig(e),this.update())})).catch((e=>{console.error(`The node extension manager appears to be missing.\n${e}`)})).finally((()=>{this.fetching=!1,this.update()}))}enableNodeExtension(e,t){this.fetching=!0,this.update(),M("node_extension_manager",{method:"POST",body:JSON.stringify({name:e,enable:t})}).then((n=>{"ok"===n.status&&(_.nodeConfigRegistry.enableNodeConfig(e,t),this.update())})).catch((e=>{console.error(`The node extension manager appears to be missing.\n${e}`)})).finally((()=>{this.fetching=!1,this.update()}))}render(){return C().createElement(I,{fetching:this.fetching,onInstallNodeExtension:this.installNodeExtension.bind(this),uninstallNodeExtension:this.uninstallNodeExtension.bind(this),enableNodeExtension:this.enableNodeExtension.bind(this),url:this.requestUrl})}}const F=new N.Token("@jupyterlab/vp4jl:INodeExtension","A node package extension panel for visual programming files.\n  This is used to install, uninstall, enable or disable node packages that can be used in the visual programming files.");var T=n(4901);function O(e,t){const n=e=>{let t=e;return"string"==typeof e&&(t=JSON.parse(e||"null")),JSON.stringify(t)};return n(e)===n(t)}class L extends m.DocumentModel{constructor(e){super(e),this._kernelSpec={},this._vpContent=null,this._kernelSpecChanged=new T.Signal(this),this._vpContentChanged=new T.Signal(this),this._vpActions=null,this._toolbarItems={},this._rendermime=null,this._outputAreaModel=new p.OutputAreaModel,this._outputAreaModelChanged=new T.Signal(this),this.contentChanged.connect(this._setProperties.bind(this))}_setProperties(){var e;const t=JSON.parse(this.toString());t.output&&!O(this._outputAreaModel.toJSON(),t.output)&&(this._outputAreaModel.fromJSON(null!==(e=t.output)&&void 0!==e?e:[]),this._outputAreaModelChanged.emit()),this.kernelSpec=t.kernelSpec,this.vpContent=t.vpContent}_setModelContent(){var e;const t=JSON.stringify({vpContent:this.vpContent,kernelSpec:this.kernelSpec,output:null===(e=this._outputAreaModel)||void 0===e?void 0:e.toJSON()});this.toString()!==t&&this.fromString(t)}saveOutputModel(){var e;const t=JSON.stringify({vpContent:this.vpContent,kernelSpec:this.kernelSpec,output:null===(e=this._outputAreaModel)||void 0===e?void 0:e.toJSON()});this.toString()!==t&&this.fromString(t)}async setKernelSpec(e){if(!e)return;const t=await e.spec;if(this.isDisposed)return;const n={name:e.name,display_name:null==t?void 0:t.display_name,language:null==t?void 0:t.language};O(this.kernelSpec,n)||(this.kernelSpec=n)}set kernelSpec(e){O(this.kernelSpec,null!=e?e:{})||(this._kernelSpec=e,this._kernelSpecChanged.emit(this._kernelSpec),this._setModelContent())}get kernelSpec(){return this._kernelSpec}setVpContent(e){this.vpContent="string"==typeof e?JSON.parse(""===e?"null":e):e}set vpContent(e){O(this._vpContent,e)||(this._vpContent=e,this._setModelContent())}get vpContent(){return this._vpContent}get outputAreaModel(){return this._outputAreaModel}get kernelSpecChanged(){return this._kernelSpecChanged}get vpContentChanged(){return this._vpContentChanged}get vpActions(){return this._vpActions}setVpActions(e){this._vpActions=e}get toolbarItems(){return this._toolbarItems}setToolbarItems(e){null==e||e.forEach((e=>{this._toolbarItems[e.name]=e}))}get rendermime(){return this._rendermime}setRendermime(e){this._rendermime=e}get outputAreaModelChanged(){return this._outputAreaModelChanged}}class D extends m.TextModelFactory{get name(){return o.modelFactory}createNew(e={}){const t=e.collaborationEnabled&&this.collaborative;return new L({...e,collaborationEnabled:t})}}class R extends m.ABCWidgetFactory{constructor(e,t){super(e),this._mainWidget=null,this._widgets=[],this._widgetId=0,this._onMouseDown=this.deactivateWidgetIfMouseDownOut.bind(this),this._rendermime=t}createNewWidget(e){e.model.setRendermime(this._rendermime);const t=new E("vp_widget_"+ ++this._widgetId,e);return this.onWidgetCreated(t),t.disposed.connect((e=>{this.onWidgetDisposed(e)})),window.requestAnimationFrame(this._addEventListenerToTab.bind(this)),t}deactivateWidgetIfMouseDownOut(e){for(const t of this._widgets){const n=t.node.getBoundingClientRect();!n||0===n.x&&0===n.y&&0===n.width&&0===n.height||(n.x<=e.clientX&&e.clientX<=n.x+n.width&&n.y<=e.clientY&&e.clientY<=n.y+n.height?t.content.activate():t.content.deactivate())}}onWidgetCreated(e){var t;this._widgets.push(e),null===this._mainWidget&&(this._mainWidget=document.getElementById("main")),1===this._widgets.length&&(null===(t=this._mainWidget)||void 0===t||t.addEventListener("mousedown",this._onMouseDown),this._addEventListeners())}onWidgetDisposed(e){var t;this._widgets.splice(this._widgets.indexOf(e),1),0===this._widgets.length&&(null===(t=this._mainWidget)||void 0===t||t.removeEventListener("mousedown",this._onMouseDown),this._removeEventListeners())}_addEventListeners(){document.addEventListener("contextmenu",this._onMouseDown);const e=document.getElementsByClassName("jp-SideBar");for(let t=0;t<e.length;t++){const n=e[t];for(const e of n.getElementsByClassName("lm-TabBar-tab"))e.addEventListener("click",this._onMouseDown)}const t=document.getElementById("jp-top-panel"),n=null==t?void 0:t.getElementsByClassName("lm-MenuBar-item");for(const e of n||[])e.addEventListener("click",this._onMouseDown)}_addEventListenerToTab(){const e=document.getElementById("jp-main-dock-panel");(null==e?void 0:e.getElementsByClassName("lm-mod-current")[0]).addEventListener("click",this._onMouseDown)}_removeEventListeners(){document.removeEventListener("contextmenu",this._onMouseDown);const e=document.getElementsByClassName("jp-SideBar");for(let t=0;t<e.length;t++){const n=e[t];for(const e of n.getElementsByClassName("button"))e.removeEventListener("click",this._onMouseDown)}const t=document.getElementById("jp-top-panel"),n=null==t?void 0:t.getElementsByClassName("lm-MenuBar-item");for(const e of n||[])e.removeEventListener("click",this._onMouseDown)}}var P=n(5126),K=n(5672),W=n(362);function B(e,t,n,o){return n.factory?n.factory(e):o(null!=t?t:"",e,n)}function V(e,t){const n=function(e){return[{name:"save",factory:t=>W.ToolbarItems.createSaveButton(e,t.context.fileChanged)},{name:"cut",command:i.cut},{name:"copy",command:i.copy},{name:"paste",command:i.paste},{name:"duplicate",command:i.duplicate},{name:"delete",command:i.del},{name:"deleteAll",command:i.deleteAll},{name:"run",command:i.run},{name:"interrupt",command:i.interruptKernel},{name:"restart",command:i.restartKernel},{name:"restart-and-run",command:i.restartKernelAndRun},{name:"spacer",type:"spacer"},{name:"kernelName",factory:e=>K.o.createKernelNameItem(e.sessionContext)},{name:"executionProgress",factory:e=>P.ExecutionIndicator.createExecutionIndicatorItem(e,void 0,void 0)}]}(e),o=(0,h.createDefaultFactory)(e);return e=>{var s;const i=n.map((n=>({name:n.name,widget:B(e,t,n,o)})));return null===(s=e.model)||void 0===s||s.setToolbarItems(i),i}}const U=new N.Token("@jupyterlab/vp4jl:IVPTracker","A widget tracker for visual programming files.\n  Use this if you want to be able to iterate over and interact with file editors\n  created by the application.");class J extends h.WidgetTracker{}var q,H=n(7206);!function(e){e.getState=function(e){var t,n;return{wasFocused:e.node.contains(document.activeElement),activeCellId:null!==(n=null===(t=e.activeCell)||void 0===t?void 0:t.model.id)&&void 0!==n?n:null}},e.handleState=function(e,t,n=!1){const{activeCell:o,activeCellIndex:s}=e;(t.wasFocused||"edit"===e.mode)&&e.activate(),n&&o&&e.scrollToItem(s,"smart",.05).catch((e=>{}))},e.changeCellType=function(e,t){const n=e.model.sharedModel;e.widgets.forEach(((o,s)=>{if(!e.isSelectedOrActive(o))return;const i=o.model.type!==t,a=o.model.type===t&&"code"===t;if(i||a){const e=o.model.toJSON();n.transact((()=>{n.deleteCell(s),e.metadata.trusted="code"===t||void 0;const o=n.insertCell(s,{cell_type:t,source:e.source,metadata:e.metadata});e.attachments&&["markdown","raw"].includes(t)&&(o.attachments=e.attachments)}))}"markdown"===t&&((o=e.widgets[s]).rendered=!1)})),e.deselectAll()}}(q||(q={}));class $ extends h.ReactWidget{constructor(e,t){super(),this.handleChange=e=>{if("-"!==e.target.value){let t=e.target.value;this._notebook.widgets.forEach(((e,n)=>{this._notebook.isSelectedOrActive(e)&&("visual code"===t?(e.model.setMetadata("code type",t),t="code"):e.model.deleteMetadata("code type"))})),function(e,t){if(!e.model||!e.activeCell)return;const n=q.getState(e);q.changeCellType(e,t),q.handleState(e,n)}(this._notebook,t),this._notebook.activate()}},this.handleKeyDown=e=>{13===e.keyCode&&this._notebook.activate()},this._trans=(t||H.nullTranslator).load("jupyterlab"),this.addClass("jp-Notebook-toolbarCellType"),this._notebook=e,e.model&&this.update(),e.activeCellChanged.connect(this.update,this),e.selectionChanged.connect(this.update,this)}render(){var e;let t="-";this._notebook.activeCell&&(t=this._notebook.activeCell.model.type);let n=!1;for(const e of this._notebook.widgets)if(this._notebook.isSelectedOrActive(e)&&e.model.type!==t){t="-",n=!0;break}return n||"visual code"!==(null===(e=this._notebook.activeCell)||void 0===e?void 0:e.model.getMetadata("code type"))||(t="visual code"),g.createElement(c.HTMLSelect,{className:"jp-Notebook-toolbarCellTypeDropdown",onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:t,"aria-label":this._trans.__("Cell type"),title:this._trans.__("Select the cell type")},g.createElement("option",{value:"-"},"-"),g.createElement("option",{value:"code"},this._trans.__("Code")),g.createElement("option",{value:"visual code"},"Visual Code"),g.createElement("option",{value:"markdown"},this._trans.__("Markdown")),g.createElement("option",{value:"raw"},this._trans.__("Raw")))}}class X extends h.ReactWidget{constructor(e,t){super(),this._editor_activated=!1,this._sceneActions=null,this.id=e,this.node.style.width="100%",this.node.style.height="100%",this.node.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation()})),this.node.addEventListener("focusout",(function(e){e.preventDefault();const t=e.relatedTarget,n=this.contains(t),o=null==t?void 0:t.classList[0].includes("Mui");t&&(n||o)&&e.stopPropagation()})),this._model=t}get sharedModel(){return this._model.sharedModel}setSceneActions(e){this._sceneActions=e}closeMenu(){var e;null===(e=this._sceneActions)||void 0===e||e.closeMenu()}get hasFocus(){return this._editor_activated}focus(){this._editor_activated||(this._editor_activated=!0,this.update())}blur(){this._editor_activated&&(this._editor_activated=!1,this.update())}get content(){let e;try{e=JSON.parse(this.sharedModel.getSource())}catch(t){e=void 0}return(t=e)&&"object"==typeof t&&Array.isArray(t.nodes)&&Array.isArray(t.edges)?e:null;var t}setContent(e){this.sharedModel.getSource()!==e&&this.sharedModel.setSource(e)}getCode(){var e;return null===(e=this._sceneActions)||void 0===e?void 0:e.sourceCode()}render(){return C().createElement(_.VPEditor,{id:this.id,content:this.content,onContentChange:this.setContent.bind(this),activated:this._editor_activated,onSceneActionsInit:this.setSceneActions.bind(this),option:{minimap:{collapsed:!0}}})}}const z="jp-VPEditor";class G{constructor(e){var t;this.edgeRequested=new T.Signal(this),this._isDisposed=!1,this._uuid="",this._options={};const n=this.host=e.host;n.classList.add(z),n.classList.add("jp-Editor"),n.addEventListener("focus",this,!1),n.addEventListener("blur",this,!1),this._uuid=null!==(t=e.uuid)&&void 0!==t?t:N.UUID.uuid4(),this._model=e.model,this._editor=function(e,t,n){const o=new X(e,t);return n.style.height="300px",n.style.overflow="auto",n.style.resize="vertical",window.requestAnimationFrame((()=>{n.isConnected&&v.Widget.attach(o,n)})),o}(this._uuid,this._model,n)}get uuid(){return this._uuid}set uuid(e){this._uuid=e}get editor(){return this._editor}get lineCount(){return 0}get model(){return this._model}get lineHeight(){return 0}get charWidth(){return 0}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this.host.removeEventListener("focus",this,!0),this.host.removeEventListener("blur",this,!0),this.host.removeEventListener("scroll",this,!0),T.Signal.clearData(this))}getOption(e){return this._options[e]}hasOption(e){return Object.keys(this._options).indexOf(e)>-1}setOption(e,t){this._options[e]=t}setOptions(e){for(const t in e)this._options[t]=e[t]}injectExtension(e){}getLine(e){}getOffsetAt(e){return 0}getPositionAt(e){return{line:0,column:0}}undo(){this.model.sharedModel.undo()}redo(){this.model.sharedModel.redo()}clearHistory(){this.model.sharedModel.clearUndoHistory()}focus(){this._editor.focus()}hasFocus(){return this._editor.hasFocus}blur(){this._editor.contentDOM.blur()}get state(){throw new Error("Method not implemented yet")}getRange(e,t,n){return""}revealPosition(e){}revealSelection(e){}getCoordinateForPosition(e){return{top:0,left:0,bottom:0,right:0,height:0,width:0,x:0,y:0,toJSON:()=>""}}getPositionForCoordinate(e){return null}getCursorPosition(){return{line:0,column:0}}setCursorPosition(e,t){}getSelection(){return this.getSelections()[0]}setSelection(e){this.setSelections([e])}getSelections(){throw new Error("Method not implemented yet")}setSelections(e){}replaceSelection(e){}getTokens(){return[]}getTokenAt(e){return{value:"",offset:0,type:""}}getTokenAtCursor(){return this.getTokenAt(this.state.selection.main.head)}newIndentedLine(){}execCommand(e){}onKeydown(e){return!1}handleEvent(e){switch(e.type){case"focus":this._evtFocus(e);break;case"blur":this._evtBlur(e)}}_evtFocus(e){this.host.classList.add("jp-mod-focused")}_evtBlur(e){this.host.classList.remove("jp-mod-focused")}}const Y=e=>(e.host.dataset.type="inline",new G(e));var Q=n(6697);class Z extends P.Notebook{isVisualCodeCell(e){return e.node.querySelectorAll(`.${z}`).length>0}activate(){super.activate(),this.closeMenus()}onResize(e){super.onResize(e),this.closeMenus()}closeMenus(){for(let e=0;e<this.widgets.length;e++){const t=this.widgets[e];this.isVisualCodeCell(t)&&t.editor.editor.closeMenu()}}handleEvent(e){this.model&&("mousedown"===e.type&&e.eventPhase===Event.CAPTURING_PHASE?(this.evtMouseDownCapture(e),this.closeMenus()):super.handleEvent(e))}findCell(e){let t=e;for(;t&&t!==this.node;){if(t.classList.contains("jp-Notebook-cell")){const e=Q.ArrayExt.findFirstIndex(this.widgets,(e=>e.node===t));if(-1!==e)return e;break}t=t.parentElement}return-1}findEventTargetAndCell(e){let t=e.target,n=this.findCell(t);return-1===n&&(t=document.elementFromPoint(e.clientX,e.clientY),n=this.findCell(t)),[t,n]}evtMouseDownCapture(e){var t;const{button:n,shiftKey:o}=e,[s,i]=this.findEventTargetAndCell(e),a=this.widgets[i];2===n&&!o&&a&&(null===(t=a.editorWidget)||void 0===t?void 0:t.node.contains(s))&&!this.isVisualCodeCell(a)&&(this.mode="command",e.preventDefault())}}class ee extends P.NotebookPanel.ContentFactory{constructor(e){super(e),this._editorFactories={},this._editorFactories.code=e.editorFactory,this._editorFactories["visual code"]=Y}createNotebook(e){return new Z(e)}createCodeCell(e){const t=e;return"visual code"===e.model.getMetadata("code type")?t.contentFactory=new ee({editorFactory:this._editorFactories["visual code"]}):e.contentFactory.editorFactory!==this._editorFactories.code&&(t.contentFactory=new ee({editorFactory:this._editorFactories.code})),super.createCodeCell(t)}}var te=n(3732),ne=n(5750);async function oe(e,t,n){var o,s;const i=e.model,a="visual code"===i.getMetadata("code type");let r="";const d=null===(o=t.session)||void 0===o?void 0:o.kernel;if(null==d||d.registerCommTarget("capture_image",((e,t)=>{e.onMsg=e=>{const t=e.content.data.image_dom_id,n=e.content.data.image_data,o=document.getElementById(t);o?o.src=`data:image/png;base64,${n}`:console.error(`image element ${t} not found, cannot set display intermediate image`)}})),a&&e.editor){const t=e.editor.editor.getCode();if(t.hasError)return e.outputArea.model.clear(),void e.outputArea.model.add({output_type:"error",ename:"Error",evalue:t.result,traceback:[]});r=t.code}else r=i.sharedModel.getSource();if(!r.trim()||!(null===(s=t.session)||void 0===s?void 0:s.kernel))return void i.sharedModel.transact((()=>{i.clearExecution()}),!1);const l={cellId:i.sharedModel.getId()};n={...i.metadata,...n,...l};const{recordTiming:c}=n;let u;i.sharedModel.transact((()=>{i.clearExecution(),e.outputHidden=!1}),!1),e.setPrompt("*"),i.trusted=!0;try{const o=p.OutputArea.execute(r,e.outputArea,t,n);if(c){const t=e=>{let t;switch(e.header.msg_type){case"status":t=`status.${e.content.execution_state}`;break;case"execute_input":t="execute_input";break;default:return!0}const n=e.header.date||(new Date).toISOString(),o=Object.assign({},i.getMetadata("execution"));return o[`iopub.${t}`]=n,i.setMetadata("execution",o),!0};e.outputArea.future.registerMessageHook(t)}else i.deleteMetadata("execution");u=e.outputArea.future;const s=await o;if(i.executionCount=s.content.execution_count,c){const e=Object.assign({},i.getMetadata("execution")),t=s.metadata.started;t&&(e["shell.execute_reply.started"]=t);const n=s.header.date;e["shell.execute_reply"]=n||(new Date).toISOString(),i.setMetadata("execution",e)}return s}catch(t){throw u&&!e.isDisposed&&e.outputArea.future===u&&e.setPrompt(""),t}}const se=[{id:"vp4jlVpCell",autoStart:!0,requires:[h.IToolbarWidgetRegistry,te.IEditorServices,P.INotebookWidgetFactory],activate:function(e,t,n,o){t.addFactory("Notebook","cellType",(e=>function(e){return new $(e.content)}(e)));const s=n.factoryService.newInlineEditor;o.contentFactory=new ee({editorFactory:s}),ne.CodeCell.execute=oe}},{id:"vp4jl:CloseMenuWhenCloseTab",autoStart:!0,requires:[a.ILabShell],activate:function(e,t){t.currentChanged.connect(((e,t)=>{const n=t.oldValue,o=null==n?void 0:n.content;o&&o instanceof Z&&o.closeMenus()}))}}],ie={id:"vp4jl:plugin",autoStart:!0,requires:[u.IRenderMimeRegistry],provides:U,activate:function(e,t){const n=o,s=new J({namespace:n.trackerNamespace}),i=new R({name:n.widgetFactory,modelName:n.modelFactory,fileTypes:[n.fileType],defaultFor:[n.fileType],toolbarFactory:V(e.commands,n.widgetFactory)},t);return i.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{s.save(t)})),s.add(t)})),e.docRegistry.addWidgetFactory(i),e.docRegistry.addModelFactory(new D),e.docRegistry.addFileType({name:n.fileType,displayName:"VP File",mimeTypes:["text/json","application/json"],extensions:[n.fileExtension],fileFormat:"text",contentType:"file"}),s}},ae={id:"vp4jl:Commands",autoStart:!0,requires:[a.ILabShell,U,h.ISessionContextDialogs,r.IFileBrowserFactory,F],optional:[r.IDefaultFileBrowser],activate:function(e,t,n,s,a,r,d){const l=o,u=i,{shell:h}=e,m=()=>ce(h,n),p=e=>{var t;if(!m())return!1;const o=ue(n,h,{...e,activate:!1});return!!(null===(t=null==o?void 0:o.model.vpActions)||void 0===t?void 0:t.getSelectedCounts().nodesCount)};e.commands.addCommand(u.createNew,{label:e=>e.isPalette?l.createNewLabelInPalette:e.isContextMenu?l.createNewLabelInContextMenu:l.createNewLabelInFileMenu,caption:l.caption,execute:async t=>{var n;const o=t.cwd||(null===(n=a.tracker.currentWidget)||void 0===n?void 0:n.model.path)||(null==d?void 0:d.model.path)||"",s=await e.commands.execute("docmanager:new-untitled",{path:o,contentType:"file",fileFormat:"text",ext:l.fileExtension,type:"file"});if(void 0!==s){const t=await e.commands.execute("docmanager:open",{path:s.path,factory:l.widgetFactory});return t.isUntitled=!0,t}}}),e.commands.addCommand(u.run,{label:"Run Visual Programming File",caption:"Run the visual programming file",execute:e=>{const t=ue(n,h,e);null==t||t.execute()},icon:e=>e.toolbar?c.runIcon:void 0,isEnabled:m}),e.commands.addCommand(u.copy,{label:e=>{var t;const o=ue(n,h,{...e,activate:!1});return e.toolbar?(null===(t=null==o?void 0:o.model.vpActions)||void 0===t?void 0:t.getSelectedCounts().nodesCount)?"Copy Nodes":"Copy Node":"Copy"},caption:e=>{var t;const o=ue(n,h,{...e,activate:!1});return(null===(t=null==o?void 0:o.model.vpActions)||void 0===t?void 0:t.getSelectedCounts().nodesCount)?"Copy theses nodes":"Copy this node"},execute:e=>{var t;const o=ue(n,h,e);o&&(null===(t=o.model.vpActions)||void 0===t||t.copySelectedNodeToClipboard())},icon:e=>e.toolbar?c.copyIcon:void 0,isEnabled:e=>p(e)}),e.commands.addCommand(u.paste,{label:"Paste",caption:"Paste from the clipboard",execute:e=>{var t;const o=ue(n,h,e);o&&(null===(t=o.model.vpActions)||void 0===t||t.pasteFromClipboard())},icon:e=>e.toolbar?c.pasteIcon:void 0,isEnabled:e=>p(e)}),e.commands.addCommand(u.del,{label:"Delete",caption:"Delete the selected node",execute:e=>{var t;const o=ue(n,h,e);o&&(null===(t=o.model.vpActions)||void 0===t||t.deleteSelectedElements())},icon:e=>e.toolbar?c.deleteIcon:void 0,isEnabled:e=>p(e)}),e.commands.addCommand(u.cut,{label:"Cut",caption:"Cut the selected node",execute:e=>{var t;const o=ue(n,h,e);o&&(null===(t=o.model.vpActions)||void 0===t||t.cutSelectedNodesToClipboard())},icon:e=>e.toolbar?c.cutIcon:void 0,isEnabled:e=>p(e)}),e.commands.addCommand(u.duplicate,{label:"Duplicate",caption:"Duplicate the selected node",execute:e=>{var t;const o=ue(n,h,e);o&&(null===(t=o.model.vpActions)||void 0===t||t.duplicateSelectedNodes())},icon:e=>e.toolbar?c.duplicateIcon:void 0,isEnabled:e=>p(e)}),e.commands.addCommand(u.deleteAll,{label:"Delete All",caption:"Delete all nodes and edges",execute:e=>{var t;const o=ue(n,h,e);o&&(null===(t=o.model.vpActions)||void 0===t||t.clear())},icon:e=>e.toolbar?c.clearIcon:void 0,isEnabled:m}),e.commands.addCommand(u.interruptKernel,{label:"Interrupt Kernel",caption:"Interrupt the kernel",execute:e=>{var t;const o=ue(n,h,e);if(!o)return;const s=null===(t=o.sessionContext.session)||void 0===t?void 0:t.kernel;return s?s.interrupt():void 0},icon:e=>e.toolbar?c.stopIcon:void 0,isEnabled:m}),e.commands.addCommand(u.restartKernel,{label:"Restart Kernel",caption:"Restart the kernel",execute:e=>{const t=ue(n,h,e);if(t)return s.restart(t.sessionContext)},icon:e=>e.toolbar?c.refreshIcon:void 0,isEnabled:m}),e.commands.addCommand(u.clearOutput,{label:"Clear Output",caption:"Clear the output",execute:e=>{console.log("clear output")},isEnabled:m}),e.commands.addCommand(u.reconnectKernel,{label:"Reconnect to Kernel",caption:"Reconnect to the kernel",execute:e=>{var t;const o=ue(n,h,e);if(!o)return;const s=null===(t=o.context.sessionContext.session)||void 0===t?void 0:t.kernel;return s?s.reconnect():void 0},isEnabled:m}),e.commands.addCommand(u.restartKernelAndRun,{label:"Restart Kernel and Run",caption:"Restart the kernel and re-run the whole file",execute:async t=>{await e.commands.execute(u.restartKernel,{activate:!1})&&await e.commands.execute(u.run)},icon:c.fastForwardIcon,isEnabled:m}),e.commands.addCommand(u.shutdownKernel,{label:"Shut Down Kernel",caption:"Shutdown the kernel",execute:e=>{const t=ue(n,h,e);if(t)return t.context.sessionContext.shutdown()},isEnabled:m}),e.commands.addCommand(u.changeKernel,{label:"Change Kernel…",execute:e=>{const t=ue(n,h,e);if(t)return s.selectKernel(t.context.sessionContext)},isEnabled:m}),e.commands.addCommand(u.showNodeExtension,{label:"Show Node Packages Manager",execute:()=>{t.activateById(l.nodeExtension)}}),e.commands.addCommand(u.hideNodeExtension,{label:"Hide Node Extension",execute:()=>{t.collapseLeft()}}),e.commands.addCommand(u.toggleNodeExtension,{label:"Node Packages Manager",execute:()=>r.isHidden?e.commands.execute(u.showNodeExtension,void 0):e.commands.execute(u.hideNodeExtension,void 0)}),e.commands.addCommand(u.toggleOutput,{label:"Output Area",execute:e=>{const t=ue(n,h,e);t&&t.toggleOutput()},isEnabled:m})}},re={id:"vp4jl:AttachCommandsToGui",autoStart:!0,requires:[l.IMainMenu,U],optional:[d.ILauncher,h.ICommandPalette],activate:function(e,t,n,o,s){const a=i,r=()=>ce(e.shell,n);t.fileMenu.newMenu.addItem({command:a.createNew,rank:30}),t.editMenu.addGroup([{command:a.copy},{command:a.paste},{command:a.duplicate},{command:a.cut},{command:a.del},{command:a.deleteAll}],4),t.runMenu.codeRunners.run.add({id:a.run,isEnabled:r}),t.kernelMenu.kernelUsers.interruptKernel.add({id:a.interruptKernel,isEnabled:r}),t.kernelMenu.kernelUsers.restartKernel.add({id:a.restartKernel,isEnabled:r}),t.kernelMenu.kernelUsers.reconnectToKernel.add({id:a.reconnectKernel,isEnabled:r}),t.runMenu.codeRunners.restart.add({id:a.restartKernelAndRun,isEnabled:r}),t.kernelMenu.kernelUsers.shutdownKernel.add({id:a.shutdownKernel,isEnabled:r}),t.kernelMenu.kernelUsers.changeKernel.add({id:a.changeKernel,isEnabled:r}),t.kernelMenu.kernelUsers.clearWidget.add({id:a.clearOutput,isEnabled:r}),t.editMenu.clearers.clearCurrent.add({id:a.clearOutput,isEnabled:r}),t.viewMenu.addItem({command:a.toggleNodeExtension,rank:9}),t.viewMenu.addItem({command:a.toggleOutput,rank:9}),null==o||o.add({command:a.createNew,category:a.commandCategory,rank:0}),null==s||s.addItem({command:a.createNew,category:a.commandCategory,args:{isPalette:!0}}),e.contextMenu.addItem({command:a.createNew,selector:".jp-DirListing-content",rank:53,args:{isContextMenu:!0}})}},de={id:"vp4jl:Restorer",autoStart:!0,optional:[a.ILayoutRestorer,U],activate:function(e,t,n){const s=o;t&&n&&t.restore(n,{command:"docmanager:open",args:e=>({path:e.context.path,factory:s.widgetFactory}),name:e=>e.context.path})}},le=[ie,ae,re,de,{id:"vp4jl:NodeExtension",autoStart:!0,optional:[a.ILayoutRestorer],provides:F,activate:function(e,t){const n=new j;return e.shell.add(n,"left"),t&&t.add(n,"vp4jlNodeExtension"),M("node_extension_manager").then((e=>{Object.entries(e.packages).forEach((([e,t])=>{(0,_.LoadPackageToRegistry)(e,t)}))})).catch((e=>{console.error(`The vp4jl server error:\n${e}`),console.error(`The vp4jl server error:\n${e}`)})),n}},{id:"vp4jl:FixContextMenuClose",autoStart:!0,requires:[a.ILabShell],activate:function(e,t){function n(){e.contextMenu.menu.isAttached&&e.contextMenu.menu.close()}function o(){const e=document.getElementsByClassName("jp-SideBar");if(e.length)for(const t of e)for(const e of t.getElementsByClassName("lm-TabBar-tab"))e.addEventListener("click",n);else window.requestAnimationFrame((()=>{o()}))}t.currentChanged.connect(((e,t)=>{t.oldValue instanceof E&&t.oldValue.content.deactivate(),n()})),window.requestAnimationFrame((()=>{o()}))}},...se];function ce(e,t){return null!==t.currentWidget&&t.currentWidget===e.currentWidget}function ue(e,t,n){const o=e.currentWidget;return!1!==n.activate&&o&&t.activateById(o.id),o}}}]);