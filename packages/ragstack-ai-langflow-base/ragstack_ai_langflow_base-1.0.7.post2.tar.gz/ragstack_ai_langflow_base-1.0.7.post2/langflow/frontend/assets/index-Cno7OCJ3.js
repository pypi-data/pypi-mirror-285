import{a$ as T,b0 as O,b1 as D,b2 as se,b3 as ae,b4 as te,b5 as re,b6 as G,b7 as V,p as ne,aC as le,r as u,j as e,I as oe,$ as v,aN as S,b8 as N,aQ as C,aP as E,aO as I,a as w,d as A,b9 as _,g as k,f as j,ba as H,aj as ie,bb as ce,aw as de,bc as F,bd as ue,be as he,bf as me,bg as pe,h as xe,au as fe,bh as ge,A as y,u as L,af as m}from"./index-CGEQ_--f.js";import{I as b}from"./index-K0lyxFWE.js";import"./input-CpIN9sXk.js";import"./popover-Cew-Yhqy.js";const je=t=>{const{mutate:o}=T();return o(["usePostAddApiKey"],async s=>(await O.post(`${D("API_KEY")}/store`,{api_key:s.key})).data,t)},M=()=>{const{query:t}=T(),o=async()=>(await O.get(`${D("FILES")}/profile_pictures/list`)).data;return t(["useGetProfilePicturesQuery"],async()=>{var i;const s=await o(),n={};return(i=s==null?void 0:s.files)==null||i.forEach(c=>{const[l,h]=c.split("/");n[l]?n[l].push(h):n[l]=[h]}),n},{placeholderData:se})},Pe=(t,o,r)=>({handlePatchPassword:async(s,n,i)=>{var c,l;if(s!==n){r({title:ae,list:[te]});return}try{s!==""&&await re(t.id,{password:s}),i({target:{name:"password",value:""}}),i({target:{name:"cnfPassword",value:""}}),o({title:G})}catch(h){r({title:V,list:[(l=(c=h==null?void 0:h.response)==null?void 0:c.data)==null?void 0:l.detail]})}}}),ye=(t,o,r,d)=>({currentUserData:r,handlePatchProfilePicture:async n=>{var i,c;try{if(n!==""){await ne(r.id,{profile_image:n});let l=le(r);l.profile_image=n,d(l)}t({title:G})}catch(l){o({title:V,list:[(c=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:c.detail]})}}}),we=(t,o)=>{u.useEffect(()=>{const r=document.getElementById(t??"null");r&&r.scrollIntoView({behavior:"smooth"})},[t]),u.useEffect(()=>{o("")},[o])},Ae=()=>e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-between gap-4 space-y-0.5",children:e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("h2",{className:"flex items-center text-lg font-semibold tracking-tight",children:["General",e.jsx(oe,{name:"SlidersHorizontal",className:"ml-2 h-5 w-5 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage settings related to Langflow and your account."})]})})}),be=({password:t,cnfPassword:o,handleInput:r,handlePatchPassword:d})=>e.jsx(e.Fragment,{children:e.jsx(v,{onSubmit:s=>{d(t,o,r),s.preventDefault()},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-2",children:[e.jsxs(N,{children:[e.jsx(C,{children:"Password"}),e.jsx(E,{children:"Type your new password and confirm it."})]}),e.jsx(I,{children:e.jsxs("div",{className:"flex w-full gap-4",children:[e.jsxs(w,{name:"password",className:"w-full",children:[e.jsx(b,{id:"pasword",onChange:s=>{r({target:{name:"password",value:s}})},value:t,isForm:!0,password:!0,placeholder:"Password",className:"w-full"}),e.jsx(A,{match:"valueMissing",className:"field-invalid",children:"Please enter your password"})]}),e.jsxs(w,{name:"cnfPassword",className:"w-full",children:[e.jsx(b,{id:"cnfPassword",onChange:s=>{r({target:{name:"cnfPassword",value:s}})},value:o,isForm:!0,password:!0,placeholder:"Confirm Password",className:"w-full"}),e.jsx(A,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})]})}),e.jsx(_,{className:"border-t px-6 py-4",children:e.jsx(k,{asChild:!0,children:e.jsx(j,{type:"submit",children:"Save"})})})]})})}),ve=(t,o,r)=>{const d=async s=>Promise.all(s.map(n=>new Promise(i=>{const c=new Image;c.src=n,c.onload=i,c.onerror=i})));u.useEffect(()=>{if(r)return;const s=[];Object.keys(t).flatMap(n=>t[n].map(i=>s.push(`${H}files/profile_pictures/${n}/${i}`))),d(s).then(()=>{o(!0)})},[t,r])};function Se({profilePictures:t,loading:o,value:r,onChange:d}){const s=u.useRef(null),n=ie(l=>l.dark),[i,c]=u.useState(!1);return u.useEffect(()=>{var l;r&&s&&((l=s.current)==null||l.scrollIntoView({behavior:"smooth",block:"center"}))},[s,r]),ve(t,c,o),e.jsx("div",{className:"flex flex-col justify-center gap-2",children:o||!i?e.jsx(ce,{}):Object.keys(t).map((l,h)=>e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"edit-flow-arrangement",children:e.jsx("span",{className:"font-normal",children:l})}),e.jsx("div",{className:"block overflow-hidden",children:e.jsx("div",{className:"flex items-center gap-1 overflow-x-auto rounded-lg bg-muted px-1 custom-scroll",children:t[l].map((p,P)=>e.jsx(j,{ref:r===l+"/"+p?s:void 0,unstyled:!0,onClick:()=>d(l+"/"+p),className:"shrink-0 px-0.5 py-2",children:e.jsx("img",{src:`${H}files/profile_pictures/${l+"/"+p}`,style:{filter:r===l+"/"+p?n?"drop-shadow(0 0 0.3rem rgb(255, 255, 255))":"drop-shadow(0 0 0.3rem rgb(0, 0, 0))":""},className:de("h-12 w-12")},P)}))})})]}))})}const Ne=({profilePicture:t,handleInput:o,handlePatchProfilePicture:r,handleGetProfilePictures:d,userData:s})=>{const{data:n,isFetching:i}=M();return e.jsx(v,{onSubmit:c=>{r(t),c.preventDefault()},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-1",children:[e.jsxs(N,{children:[e.jsx(C,{children:"Profile Picture"}),e.jsx(E,{children:"Choose the image that appears as your profile picture."})]}),e.jsx(I,{children:e.jsx("div",{className:"py-2",children:e.jsx(Se,{profilePictures:n,loading:i,value:t==""?(s==null?void 0:s.profile_image)??F[parseInt((s==null?void 0:s.id)??"",30)%F.length]:t,onChange:c=>{o({target:{name:"profilePicture",value:c}})}})})}),e.jsx(_,{className:"border-t px-6 py-4",children:e.jsx(k,{asChild:!0,children:e.jsx(j,{type:"submit",children:"Save"})})})]})})},Ce=({apikey:t,handleInput:o,handleSaveKey:r,loadingApiKey:d,validApiKey:s,hasApiKey:n})=>e.jsx(e.Fragment,{children:e.jsx(v,{onSubmit:i=>{i.preventDefault(),r(t,o)},children:e.jsxs(S,{"x-chunk":"dashboard-04-chunk-2",id:"api",children:[e.jsxs(N,{children:[e.jsx(C,{children:"Store API Key"}),e.jsx(E,{children:(n&&!s?ue:n?"":he)+me})]}),e.jsx(I,{children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsx("div",{className:"flex w-full gap-4",children:e.jsxs(w,{name:"apikey",className:"w-full",children:[e.jsx(b,{id:"apikey",onChange:i=>{o({target:{name:"apikey",value:i}})},value:t,isForm:!0,password:!0,placeholder:"Insert your API Key",className:"w-full"}),e.jsx(A,{match:"valueMissing",className:"field-invalid",children:"Please enter your API Key"})]})}),e.jsxs("span",{className:"pr-1 text-xs text-muted-foreground",children:[pe," ",e.jsx("a",{className:"text-high-indigo underline",href:"https://langflow.store/",target:"_blank",children:"langflow.store"})]})]})}),e.jsx(_,{className:"border-t px-6 py-4",children:e.jsx(k,{asChild:!0,children:e.jsx(j,{loading:d,type:"submit","data-testid":"api-key-save-button-store",children:"Save"})})})]})})}),Ke=()=>{const t=xe(a=>a.setCurrentFlowId),{scrollId:o}=fe(),[r,d]=u.useState(ge),{autoLogin:s}=u.useContext(y),n=L(a=>a.setSuccessData),i=L(a=>a.setErrorData),{userData:c,setUserData:l}=u.useContext(y),h=m(a=>a.hasStore),p=m(a=>a.validApiKey),P=m(a=>a.hasApiKey),U=m(a=>a.loadingApiKey),{password:Y,cnfPassword:q,profilePicture:B,apikey:Q}=r,{storeApiKey:W}=u.useContext(y),K=m(a=>a.updateHasApiKey),R=m(a=>a.updateValidApiKey),$=m(a=>a.updateLoadingApiKey),{handlePatchPassword:z}=Pe(c,n,i),J=()=>{const{data:a}=M();return a},{handlePatchProfilePicture:X}=ye(n,i,c,l);we(o,t);const{mutate:Z}=je({onSuccess:()=>{n({title:"API key saved successfully"}),K(!0),R(!0),$(!1),x({target:{name:"apikey",value:""}})},onError:a=>{var f,g;i({title:"API key save error",list:[(g=(f=a==null?void 0:a.response)==null?void 0:f.data)==null?void 0:g.detail]}),K(!1),R(!1),$(!1)}}),ee=a=>{a&&(Z({key:a}),W(a))};function x({target:{name:a,value:f}}){d(g=>({...g,[a]:f}))}return e.jsxs("div",{className:"flex h-full w-full flex-col gap-6",children:[e.jsx(Ae,{}),e.jsxs("div",{className:"grid gap-6",children:[e.jsx(Ne,{profilePicture:B,handleInput:x,handlePatchProfilePicture:X,handleGetProfilePictures:J,userData:c}),!s&&e.jsx(be,{password:Y,cnfPassword:q,handleInput:x,handlePatchPassword:z}),h&&e.jsx(Ce,{apikey:Q,handleInput:x,handleSaveKey:ee,loadingApiKey:U,validApiKey:p,hasApiKey:P})]})]})};export{Ke as GeneralPage,Ke as default};
